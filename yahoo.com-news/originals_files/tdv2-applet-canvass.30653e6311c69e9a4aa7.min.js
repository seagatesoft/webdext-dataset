webpackJsonp([11],{1156:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.session.query,o=e.getStore(n(189)).getState(),r=t.instanceId,i=t.oauthConsumerKey||o.oauthConsumerKey,l=t.oauthConsumerSecret||o.oauthConsumerSecret,c=t.namespace||s.namespace||o.namespace,u=t.recommended;if(!r||!l||!i)return a("Required fields missing",null);var d=e.getStore(n(187)).getCommentsState(r),f=t.tagsAnd||d.tagsAnd||null,p=t.tagsOr||d.tagsOr||null,m=t.context||s.context||"YahooGlobal";if(u&&d.get("recommendedTags")||!u&&d.get("relatedTags"))return a&&a();var g={context:m,count:t.count||10,lang:t.lang||o.lang||"en-US",namespace:c,region:t.region||o.region||"US",oauthConsumerKey:i,oauthConsumerSecret:l};g.query=n(191).createSearchQuery(f,p,m,c),e.service.read(u?"canvass.getRecommendedTags_ns":"canvass.getTrendingTags_ns",g,{},function(t,n){return t||!n||n.error?a():(u?e.dispatch("CANVASS_GET_RECOMMENDED_TAGS_SUCCESS",{instanceId:r,recommendedTags:n}):e.dispatch("CANVASS_GET_RELATED_TAGS_SUCCESS",{instanceId:r,relatedTags:n}),a())})},e.exports.displayName="loadRelatedTags"},1198:function(e,t,n){e.exports={controllerViews:{CanvassApplet:n(2591)},stores:{CanvassCommentFormStore:n(1806),CanvassConfigStore:n(189),CanvassLinkEnhancerStore:n(2228),CanvassSentimentsStore:n(2229),CanvassStore:n(187),CanvassTumblrStore:n(2040),ProfileStore:n(193)}}},1268:function(e,t,n){function a(e){var t=i.getInstance();t&&t.execute("pageview",{pageParams:{pd:"canvass-"+e,navtype:"client"}})}function s(e,t){var a={sec:"cmmts",subsec:"canvass",outcm:"show"};t&&(a=n(19)(a,t));var s=i.getInstance();s&&s.execute("beacon",{beaconType:"beaconEvent",arguments:[e,a,a.outcm]})}function o(e){var t={sec:"cmmts",_p:"0",subsec:"canvass",outcm:"clicked"};e&&(t=n(19)(t,e));var a=i.getInstance();a&&a.execute("beacon",{beaconType:"beaconClick",arguments:[t.sec,t.slk||"-",t._p,t,t.outcm]})}function r(e,t){if(!l[e])throw new Error('There is no I13nModel for "'+e+'"');return t?Object.assign({},l[e],t):l[e]}var i=n(17).ReactI13n,l={login:{slk:"login",elm:"cmmt_login",itc:0,outcm:"login"},"activity-indicator":{elm:"presence",slk:"presence_click"},"comments-seen":{elm:"cmmt_seen",outcm:"seen"},"comments-expand":{slk:"expand",elm:"btn",outcm:"open"},"comments-showMore":{slk:"load more",elm:"cmmt_more",outcm:"more"},"comments-showNew":{slk:"load new",elm:"cmmt_new",outcm:"more"},"comment-delete":{slk:"delete",elm:"cmmt_delete",itc:1,outcm:"delete"},"comment-report-cancel":{slk:"close",elm:"cmmt_abuse",outcm:"close"},"comment-flag":{slk:"abuse",elm:"cmmt_abuse",itc:1,outcm:"open"},"comment-block":{slk:"mute",elm:"cmmt_mute",outcm:"close"},"comment-report-done":{elm:"cmmt_abuse",outcm:"close",itc:1},"comment-post":{slk:"post",elm:"cmmt_post",outcm:"post"},"comment-seemore":{slk:"see more",elm:"cmmt_more",outcm:"more"},guidelines:{slk:"guideline show",elm:"cmmt_guideline"},options:{elm:"cmmt_options",slk:"options",outcm:"options"},"replies-hide":{slk:"close replies",elm:"cmmt_replies",outcm:"hide"},"replies-show":{slk:"open replies",elm:"cmmt_replies",outcm:"show"},reply:{slk:"open reply",elm:"cmmt_reply",outcm:"focus"},"reply-post":{slk:"post reply",elm:"cmmt_reply",outcm:"post"},react:{slk:"open reactions",elm:"cmmt_react"},vote:{elm:"cmmt_vote",outcm:"rate"},link:{slk:"smartlink",elm:"cmmt_link",itc:0,outcm:"navigate"},"context-link":{elm:"cmmt_ctx",itc:0},"tumblr-icon":{slk:"gif-show",elm:"cmmt_gif",outcm:"show"},"tumblr-post":{elm:"cmmt_gif",outcm:"post"},"link-prvw-close":{slk:"link-prvw-close",elm:"cmmt_link",outcm:"close"},"text-input":{slk:"text-input",elm:"cmmt_text",outcm:"focus"},sort:{elm:"cmmt_sort",outcm:"sort"},"sort-btn":{elm:"cmmt_sort_btn"},"user-avatar-tap":{slk:"open user messages",elm:"cmmt_avatar",outcm:"history"},"user-comments-tap":{slk:"open user messages",elm:"cmmt_history",outcm:"history"},"user-name-tap":{slk:"open user messages",elm:"cmmt_username",outcm:"history"},"user-close-tap":{slk:"close user messages",elm:"cmmt_username",outcm:"history"},"recommended-tags":{elm:"cmmt_suggested_tag"},"related-tags":{elm:"cmmt_trending_tag"},"sentiments-tap":{slk:"sentiments",elm:"cmmt_sentiments",outcm:"show"},"sentiments-close-tap":{slk:"sentiments close",elm:"cmmt_sentiments",outcm:"hide"}};e.exports={getI13nModel:r,fireRapidEvent:s,fireRapidClick:o,fireRapidPageView:a}},1335:function(e,t){function n(e,t){return t.forEach(function(t){e[t]=e[t].bind(e)}),e}e.exports=n},1389:function(e,t){e.exports={SORT_HIGHEST_RATED:"popular",SORT_LATEST:"createdAt",SORT_NEWEST:"newest",SORT_OLDEST:"oldest",SORT_MOST_REPLIED:"mostdiscussed",DEFAULT_SORT:"popular",THUMB_PROPS:{thumb_down:{color:"#188fff",icon:"thumbsdown-outline",selectedIcon:"thumbsdown-fill",showLabel:!1,size:14,voteType:"down"},thumb_up:{color:"#188fff",icon:"thumbsup-outline",selectedIcon:"thumbsup-fill",showLabel:!1,size:14,voteType:"up"}}}},1525:function(e,t){if(void 0===n)var n={};n.CoreArrowUp={name:"CoreArrowUp",height:49,width:49,path:"M2.053 36.584l2.18 2.18c1.353 1.364 3.76 1.364 5.11 0L25.014 23.09l15.68 15.68c1.408 1.394 3.69 1.394 5.102-.01l2.177-2.18c1.367-1.354 1.367-3.76.003-5.104L27.562 11.053c-1.407-1.39-3.688-1.395-5.102.01L2.043 31.486c-1.39 1.404-1.395 3.684.01 5.1z"},void 0!==e&&e.exports&&(e.exports=n.CoreArrowUp)},1561:function(e,t,n){"use strict";e.exports=new(n(1598))},1579:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=t.instanceId,o=e.session.query,r=e.getStore(n(189)).getState();if(!s||!r.oauthConsumerSecret||!r.oauthConsumerKey)return a("Required fields missing",null);var i=e.getStore(n(187)).getCommentsState(s),l=t.tagsAnd||o.tagsAnd||null,c=t.tagsOr||o.tagsOr||null,u=n(191).joinFilterTags(l,t.selectedTags),d={context:t.context||o.context||"YahooGlobal",index:t.startIndex||t.endIndex||null,lang:r.lang,region:r.region,namespace:t.namespace||i.get("namespace")||r.namespace,oauthConsumerKey:r.oauthConsumerKey,oauthConsumerSecret:r.oauthConsumerSecret};(u||c)&&(d.query=n(191).createSearchQuery(u,c,d.context,d.namespace)),t.refresh&&(d.excludeCurrentUser=!0),(t.userActivity||r.userActivity)&&(d.userActivity=!0),e.service.read(u||c?"canvass.getMessageListSearchCount":"canvass.getMessageListCount_ns",d,{},function(n,i){if(n||!i)return a(n,null);if(d.index&&0===i.count)return a();var l={readingUsersCount:i.readingUsersCount||0,typingUsersCount:i.typingUsersCount||0};if(t.refresh)return e.dispatch("CANVASS_GET_NEW_MESSAGES_COUNT_SUCCESS",{count:i.count,index:d.index,instanceId:s,userActivity:l}),a();e.dispatch("CANVASS_COUNT_SUCCESS",{context:d.context,contextDisplayText:t.contextDisplayText||o.contextDisplayText||null,contextUrl:t.contextUrl||o.contextUrl||null,count:i.count,expanded:t.expanded,index:d.index,instanceId:s,messageList:[],messagesPerPage:r.messagesPerPage,namespace:d.namespace,sortBy:t.sortBy,userActivity:l}),a(null,{messagesCount:i.count})})},e.exports.displayName="loadMessagesCount"},1580:function(e,t,n){"use strict";e.exports=function(e,t,a){!t.instanceId&&t.componentProps&&t.componentProps.id&&(t=t.componentProps);var s=t.instanceId||t.id,o=t.componentConfig||e.getStore(n(111)).getConfig(s)||{},r=n(26)(o,["ui","expandedCount"],0),i=n(26)(e.getStore(n(18)).getCurrentRoute(),["query"],{}),l=!!r||("1"===i.expanded||n(26)(o,["ui","expanded"],!0)),c="1"===n(26)(e,["session","dimensions","authed"]),u=t.messageId,d=n(26)(o,["ui","presence"])||{},f=t.replyId,p=n(26)(o,["ui","tags"])||{};if(!(s&&t.context&&t.oauthConsumerKey&&t.oauthConsumerSecret||o.enableInitAction))return a&&a();t.hasOwnProperty("messageId")||(u=i.messageId,f=i.replyId),u&&!f?l=!0:u&&f&&(l=!1);var m={instanceId:s,context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,expanded:l,namespace:t.namespace||i.namespace,smartTop:n(26)(o,["ui","smartTop"]),sortBy:t.sortBy||n(26)(o,["ui","sortTabs","defaultTab"],n(1389).DEFAULT_SORT),tagsAnd:t.tagsAnd,tagsOr:t.tagsOr,trendingTags:t.trendingTags||n(26)(p,["trending","enabled"]),type:t.type,userActivity:d.enabled||d.readingUsersCount};u&&(m.messageId=u,m.replyId=f),r&&(m.messagesPerPage=r),e.dispatch("CANVASS_INIT",m);var g={loadUser:{action:n(1581),isCritical:!0},loadConfig:{action:n(1688),isCritical:!0,params:{enableRelatedTags:t.enableRelatedTags,enableSentiments:t.enableSentiments,lang:t.lang,messagesPerPage:t.messagesPerPage,namespace:m.namespace,rankingProfile:o.rankingProfile,region:t.region,oauthConsumerKey:t.oauthConsumerKey,oauthConsumerSecret:t.oauthConsumerSecret,smartTop:m.smartTop,trendingTags:m.trendingTags,uploadOptions:t.uploadOptions,userActivity:m.userActivity}},loadMessages:["loadUser","loadConfig",{action:n(l?501:1579),params:m}]};c&&n(26)(p,["recommended","enabled"])&&(g.loadRelatedTags=["loadConfig",{action:n(1156),params:Object.assign({recommended:!0},m)}]),u&&(g.loadMessage=["loadMessages",{action:n(1689),params:m}]),n(281)(e,g,a)},e.exports.displayName="initAction"},1581:function(e,t,n){"use strict";e.exports=function(e,t,a){e.executeAction(n(1151).getProfile,{},a)}},1598:function(e,t,n){"use strict";function a(e){this._styles={},e&&this.set(e)}function s(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&e[t]&&(n+=" "+t);return n}function o(e){return e?(Array.isArray(e)&&(e=e.join(" ")),"object"==typeof e&&(e=s(e)),e.trim().split(p)):[]}function r(e,t){return e[t.replace(m,"")]=t,e}function i(e){return o(e).reduce(r,{})}function l(e){return Object.keys(e).map(function(t){return e[t]}).join(" ")}function c(e){if(Array.isArray(e))return e.forEach(c,this);Object.keys(e).forEach(function(t){this._styles[t]=g(this._styles[t]||{},i(e[t]))},this)}function u(e,t){var n={};return o(e).forEach(function(e){g(n,this._styles[e])},this),t&&g(n,i(t)),l(n)}function d(e,t){return g(e,i(t))}function f(){return l([].reduce.call(arguments,d,{}))}var p=/\s+/g,m=/\(.+\)/,g=n(145);a.prototype={set:c,get:u,dedupe:f},e.exports=a},1688:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.session.query,o=!1,r=!1,i=e.getStore(n(189)).getState(),l=n(26)(e,["session","dimensions"],{});null===t&&(t=i);var c={lang:t.lang||l.lang||"en-US",region:t.region||l.region||"US",oauthConsumerKey:t.oauthConsumerKey||s.oauthConsumerKey,oauthConsumerSecret:t.oauthConsumerSecret||s.oauthConsumerSecret};if(!c.oauthConsumerKey||!c.oauthConsumerSecret)return a();if(i.success&&i.oauthConsumerKey===c.oauthConsumerKey&&i.oauthConsumerSecret===c.oauthConsumerSecret)return a();var u=t.uploadOptions||s.uploadOptions,d=t.enableRelatedTags||s.enableRelatedTags,f=t.messagesPerPage||s.messagesPerPage||10,p=t.enableSentiments||s.enableSentiments,m=t.namespace||s.namespace;if(u){u.split(",").forEach(function(e){switch(e){case"ALL":o=!0,r=!0;break;case"GIF":o=!0;break;case"SMARTLINKS":r=!0}})}else o=!0,r=!0;var g=e.loadDeferredResource("canvassConfig",c.oauthConsumerKey,"tdv2-applet-canvass");if(g.resolve){e.service.read("canvass.getClientAppConfig",c,{},function(e,t){if(e||!t||t.error)return g.reject(e);g.resolve(t)});var h={allowAnimatedGIF:o,allowSmartlinks:r,enableRelatedTags:d,enableSentiments:p,lang:c.lang,messagesPerPage:f,namespace:m||"yahoo_content",notificationInterval:0,oauthConsumerKey:c.oauthConsumerKey,oauthConsumerSecret:c.oauthConsumerSecret,pollingInterval:-1,rankingProfile:t.rankingProfile||"",region:c.region,scoreAlgo:"",smartTop:t.smartTop,trendingTags:t.trendingTags,uploadOptions:u,userActivity:t.userActivity};return g.promise.then(function(t){h.allowAnimatedGIF=o&&t.allowAnimatedGIF,h.allowSmartlinks=r&&t.allowSmartlinks,h.namespace=t.primaryNamespace||h.namespace,h.notificationInterval=t.notificationIntervalSeconds||0,h.pollingInterval=t.pollingIntervalSeconds||-1,h.rankingProfile=t.rankingProfile||h.rankingProfile,h.scoreAlgo=t.scoreAlgo||"",e.dispatch("CANVASS_GET_CONFIG_SUCCESS",h)}).catch(function(t){e.dispatch("CANVASS_GET_CONFIG_FAILURE",h)})}return g.promise},e.exports.displayName="loadCanvassConfig"},1689:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.getStore(n(189)).getState(),o=t.instanceId,r=t.messageId,i=t.replyId,l=t.oauthConsumerKey||s.oauthConsumerKey,c=t.oauthConsumerSecret||s.oauthConsumerSecret;if(!o||!c||!l)return a("Required fields missing",null);var u={context:t.context,lang:t.lang||s.lang||"en-US",messageId:r,namespace:t.namespace||s.namespace,oauthConsumerKey:l,oauthConsumerSecret:c,region:t.region||s.region||"US"};i&&(u.replyCount=s.messagesPerPage||10,u.replyId=i),e.service.read(i?"canvass.getDeepLink_ns":"canvass.getMessage_ns",u,{},function(t,n){var s=n&&n.canvassMessage||n;return t||!s||n.error?(e.dispatch("CANVASS_GET_MESSAGE_FAILURE",{err:t,instanceId:o}),a()):(e.dispatch("CANVASS_GET_MESSAGE_SUCCESS",{instanceId:o,messageId:r,message:s,replyId:i}),n.canvassReplies&&n.canvassReplies.replies&&e.dispatch("CANVASS_REPLIES_SUCCESS",{instanceId:o,isUserMessageHistory:!1,messageId:r,nextIndex:n.canvassReplies.nextIndex,prevIndex:n.canvassReplies.previousIndex,replyList:n.canvassReplies.replies}),a())})},e.exports.displayName="loadMessage"},1690:function(e,t){function n(e){if(!e)return null;var t={},n=e.split("/");return t.uuid=n[3],n[5]&&(t.commentId=n[5]),n[7]&&(t.replyId=n[7]),t}function a(e){var t=e.session.protocol+"://"+e.session.host;try{var n=e.getStore("RouteStore"),a=n.getCurrentNavigate()||{},s=a.url;return s?t+s:location.href}catch(e){return t}}function s(e){var t="https://login.yahoo.com/";return e&&e.session?t+"?.intl="+e.session.dimensions.intl+"&.lang="+e.session.dimensions.lang+"&.done="+encodeURIComponent(e.contextUrl||a(e)):t+"?.intl=US&.lang=en-US&.done="+encodeURIComponent("https://www.yahoo.com")}e.exports={getParsedURI:n,getRoute:a,getLoginUrl:s}},1805:function(e,t,n){n(1561).set({btn:"Ff(ss) Fz(14px) Fw(b) Bdw(0) Ta(c) Cur(p) Va(m) Bdrs(4px) O(n)! Lh(n)","btn-primary":"Bgc(#188fff) Bgc(#003abc):h C(#fff) Bd(n)","btn-secondary":"Bgc(#fff) C(#188fff) Bdw(2px) Bdc(#188fff) Bd C(#fff):h Bgc(#188fff):h","btn-spacing":"My(20px) Px(30px) Py(10px)"}),e.exports=n(1561)},1806:function(e,t,n){"use strict";e.exports=n(16)({storeName:"CanvassCommentFormStore",statics:{handlers:{CANVASS_HEARTBEAT_SUCCESS:"heartbeatSuccess",CANVASS_POST_FAILURE:"canvassFailure",CANVASS_POST_SUCCESS:"canvassSuccess"}},initialize:function(){this.state={activeForm:null,commenting:{},errorMessage:""}},canvassFailure:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state.errorMessage="CANVASS_NETWORK_ERROR",this.state.messageId=e.messageId,this.state.replyId=null,this.emitChange()},canvassSuccess:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state=Object.assign(this.state,e,{errorMessage:"",replyId:e.replyId||null}),this.emitChange()},isActiveForm:function(e){var t=this.state.activeForm;return!!t&&t.messageId===e.messageId&&t.replyId===e.replyId},getActiveForm:function(){return this.state.activeForm||{}},setActiveForm:function(e){this.isActiveForm(e)||(this.state.activeForm={messageId:e.messageId,replyId:e.replyId},this.emitChange())},setFormInactive:function(e){this.isActiveForm(e)&&(this.state.activeForm=e.replyId?{messageId:e.messageId}:null,this.emitChange())},setCommentingState:function(e,t){var n=this.state.commenting[e]||!1;e&&n!==t&&(this.state.commenting=Object.assign({},this.state.commenting),this.state.commenting[e]=t,this.emitChange())},heartbeatSuccess:function(e){var t=e.eventType,n=e.messageId||e.context;"START_TYPING"===t&&n?this.setCommentingState(n,!0):"STOP_TYPING"===t&&n&&this.setCommentingState(n,!1)},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}})},2038:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.getStore(n(189)).getState(),o={lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},r=Object.assign({},t,o);if(!r.guid||!r.oauthConsumerSecret||!r.oauthConsumerKey)return a();var i={userId:r.guid,sortBy:r.sortBy||n(1389).DEFAULT_SORT,index:r.startIndex||r.endIndex||null,count:r.count||10,lang:r.lang||"en-US",region:r.region||"US",oauthConsumerKey:r.oauthConsumerKey,oauthConsumerSecret:r.oauthConsumerSecret};e.service.read("canvass.getUserMessageHistory",i,{},function(t,s){if(t||!s||s.error)return e.dispatch("CANVASS_USER_HISTORY_GET_FAILURE",t),a&&a();var o=s.canvassMessages||[];e.dispatch("CANVASS_USER_HISTORY_GET_SUCCESS",{messageList:o,instanceId:r.instanceId,count:s.total&&s.total.count||0,startIndex:n(26)(o,[0,"index"],null),endIndex:n(26)(o,[o.length-1,"index"],null),sortBy:i.sortBy,showPrevClicked:r.showPrevClicked,guid:r.guid,image:r.image,name:r.name}),a&&a()})},e.exports.displayName="loadUserMessages"},2039:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(5)),d=a(n(2593)),f=function(e){function t(){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),r(t,[{key:"renderCommentNode",value:function(e,t){var n=this.props,a=n.cpos,s=void 0===a?null:a,o=n.deepLink,r=void 0===o?{}:o,i=e.tags,l=e&&e.meta&&e.meta.contextInfo||{},f=l.url||n.parentContextUrl||"",p=l.displayText||n.parentContextDisplayText||"",m=r.replyId&&r.replyId===e.replyId,g=!m&&!e.replyId&&r.messageId===e.messageId,h=(0,u.default)(n.itemClassName,{"Bgc(#f4f9ff)":m||g}),v=null===s;return c.default.createElement(d.default,{className:h,contextId:e.contextId,cpos:v?t:s,data:e,isReadOnly:n.isReadOnly,isTopComments:n.isTopComments,key:"comment-"+(e.replyId||e.messageId),messageNamespace:e.namespace,parentContextDisplayText:v&&p?p:"",parentContextUrl:v&&f?f:"",parentTags:v&&i.length?i:[],pos:v?null:t,seeMore:this.context.componentConfig.ui.seeMore,sortBy:n.sortBy})}},{key:"render",value:function(){var e=this.props,t=e.list;return t&&t.length?c.default.createElement("ul",{className:(0,u.default)("comments-list List(n) Ovs(touch) Pos(r)",e.className)},t.map(this.renderCommentNode,this)):null}}]),t}(n(1).PureComponent);f.defaultProps={cpos:null,isReadOnly:!1,itemClassName:"",list:[],sortBy:""},f.contextTypes={componentConfig:l.default.object.isRequired},t.default=f,e.exports=t.default},2040:function(e,t,n){"use strict";function a(e){return e.getIn(["gifs",0,"image","resolutions"])}function s(e){return e.get("blogName","")}e.exports=n(291)({storeName:"CanvassTumblrStore",statics:{handlers:{TUMBLR_RELOAD:"reloadCache",TUMBLR_LOAD_GIFS:"loadGifs",TUMBLR_LOAD_GIFS_ERROR:"loadGifsError"}},initialize:function(){this._state=n(6).fromJS({data:{}})},reloadCache:function(){return this.emitChange()},loadGifs:function(e){var t=e.key,o=n(6).fromJS(e.data.gifresult),r=n(26)(e,["data","offset"],0),i=o.map(a),l=o.map(s);e.offset&&this.get("data").getIn([t]).size&&(i=this.get("data").getIn([t,"stickers"]).concat(i),l=this.get("data").getIn([t,"authors"]).concat(l)),this.mergeState({data:this.get("data").mergeIn([t],{stickers:i,authors:l,offset:r,error:null})})},loadGifsError:function(e){var t=e.key,n=this.get("data").getIn([t,"error"]),a=e.error||"TUMBLR_LOAD_ERROR";if(a===n)return this.emitChange();var s=null,o=null;e.offset&&this.get("data").getIn([t]).size&&(s=this.get("data").getIn([t,"stickers"]),o=this.get("data").getIn([t,"authors"])),this.mergeState({data:this.get("data").mergeIn([t],{stickers:s,authors:o,offset:e.offset,error:a})})}})},2119:function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(a){if(n[a])return n[a].exports;var s=n[a]={exports:{},id:a,loaded:!1};return e[a].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(1),r=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.social,o=void 0===s?"":s,r=n.newWindow,i=void 0===r||r,l=n.className,c=void 0===l?"":l;if(a(this,e),this._text=t,!t)return!1;if(this._cfg={newWindow:i,className:c},this.convertLinks(),o){var u=e.getSocialMeta(o);u&&this.convertSocialLinks(u)}}return s(e,[{key:"getAttrs",value:function(){var e=this._cfg,t=e.className,n=e.newWindow,a=[];return n&&a.push('target="_blank" rel="noopener noreferrer"'),t&&a.push('class="'+t+'"'),a.length?" "+a.join(" "):""}}],[{key:"getSocialMeta",value:function(e){return{twitter:{base:"https://twitter.com/",hashPath:"hashtag/"}}[e]}}]),s(e,[{key:"convertLinks",value:function(){var e=this.getAttrs();this._text=this._text.replace(new RegExp(r.default.URLPATTERN,"gim"),'<a href="$&"'+e+">$&</a>").replace(new RegExp(r.default.PSEUDOURLPATTERN,"gim"),'$1<a href="http://$2"'+e+">$2</a>")}},{key:"convertSocialLinks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.base,n=void 0===t?"https://twitter.com/":t,a=e.hashPath,s=void 0===a?"hashtag/":a,o=this.getAttrs();this._text=this._text.replace(new RegExp(r.default.MENTIONS,"gi"),function(e,t,a,s){return t?e:'<a href="'+n+s+'" title="Follow '+s+'"'+o+">@"+s+"</a>"}).replace(new RegExp(r.default.HASHTAGS,"gi"),function(e,t,a,r){return t?e:'<a href="'+n+s+r+'" title="Search tag: '+r+'"'+o+">#"+r+"</a>"})}},{key:"getText",value:function(){return this._text}}]),e}(),e.exports=t.default},function(e,t){"use strict";e.exports=Object.freeze({URLPATTERN:"\\b(?:https?|ftp)://[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]",PSEUDOURLPATTERN:"(^|[^/])(www\\.[\\S]+(\\b|$))",MENTIONS:"(://|>)?(@([_a-z0-9-]+))",HASHTAGS:"(://[^ <]*|>)?(#([_a-z0-9-]+))"})}])})},2221:function(e,t,n){"use strict";e.exports=function(e,t,a){function s(t,n){if(t||!n||n.error)return e.dispatch("CANVASS_VOTE_FAILURE",t),a();e.dispatch("CANVASS_VOTE_SUCCESS",c),a()}var o={},r="clear"===t.voteType?"delete":"update",i=t.replyId?"canvass.voteReply_ns":"canvass.voteMessage_ns",l=e.getStore(n(189)).getState(),c=Object.assign({lang:l.lang,region:l.region,oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret},t);"update"===r?e.service.update(i,c,o,{},function(e,t){s(e,t)}):"delete"===r&&e.service.delete(i,c,{},function(e,t){s(e,t)})}},2222:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(n(0)),o=a(n(1)),r=a(n(5)),i=a(n(283)),l=a(n(1165)),c=a(n(2227)),u=function(e,t){var a=e.creator,s=e.fromCommentForm,c=void 0===s?null:s,u=e.imageUrl,d=e.isReadOnly,f=e.isReply,p=t.guid,m=t.intl,g=t.isUserMessageHistory,h=t.handleUserMessages,v=t.pos,y=void 0===v?null:v,x=a===p,S=h&&!g&&!d,b=(0,n(1268).getI13nModel)("user-avatar-tap",{t1:a,t2:c?1:0}),C=(0,n(1268).getI13nModel)("user-name-tap",{t1:a,t2:c?1:0}),T=e.name;T=i.default.decode(T||m.formatMessage({id:"CANVASS_ANONYMOUS"}));var E=S?h.bind(void 0,a,u,T):null,O=x?m.formatMessage({id:"CANVASS_SEE_MY_HISTORY"}):m.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:T}),M=(0,r.default)("avatar Bdrs(46.5%) Pos(a)! Start(0)",{"Cur(p)":S}),_=(0,r.default)("username D(ib) Fw(b) Mend(10px) Fz(14px)",{"C(#26282a)":!S,"C(#188fff) Cur(p)":S}),I=f||null!==y?28:40;return o.default.createElement("div",{className:"D(ib)"},o.default.createElement(n(17).I13nDiv,{bindClickEvent:!0,i13nModel:b,onClick:E},o.default.createElement(l.default,{src:u,name:T,enableAlphatar:!0,title:g?"":O,forceLoad:!0,size:I,className:M})),c?null:o.default.createElement(n(17).I13nDiv,{i13nModel:C,bindClickEvent:!0,onClick:E,className:_},T))},d=function(e,t){var a=e.fromCommentForm,s=e.activityAt,i=e.createdAt,l=e.isReply,d=e.replyCount,f=e.sortBy,p=(0,r.default)("byline Fz(13px)",{"Fl(start)":a,"Mt(6px)":a&&l}),m="newest"===f&&d&&s&&s!==i;return o.default.createElement("div",{className:p},u.call(void 0,e,t),i?o.default.createElement(c.default,null,o.default.createElement("span",{className:"time-ago C(#878c91) Fz(12px)"},o.default.createElement(n(28).FormattedRelative,{value:i}),m?o.default.createElement("span",null,o.default.createElement("i",{"aria-hidden":"true",className:"Mx(8px)"},"â€¢"),o.default.createElement(n(28).FormattedMessage,{id:"CANVASS_LAST_REPLY_TIME",values:{timeAgo:t.intl.formatRelative(s)}})):void 0)):null)};d.contextTypes={guid:s.default.string,handleUserMessages:s.default.func,intl:s.default.object.isRequired,isUserMessageHistory:s.default.bool,pos:s.default.number},t.default=d,e.exports=t.default},2223:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){var n=e.getStore(E.default),a=e.getStore(T.default),s=e.getStore(C.default),o=e.getStore(S.default),r=o.getState(),i=e.getStore(b.default),l=o.isActiveForm(t),c=o.getActiveForm();return{guid:n.getGUID(),isActive:l,isHidden:!l&&t.forReply&&(c.messageId===t.messageId||t.replyId),isSignedIn:n.isSignedIn(),userProfile:a.getProfile(),enhancedLink:(0,v.default)(s.getState()),commentForm:(0,v.default)(r),isProfileLoaded:a.isLoaded(),configStoreState:(0,v.default)(i.getState())}}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},u=a(n(0)),d=a(n(1)),f=a(n(1561)),p=a(n(1335)),m=a(n(5)),g=a(n(26)),h=a(n(209)),v=a(n(513)),y=a(n(486)),x=a(n(187)),S=a(n(1806)),b=a(n(189)),C=a(n(2228)),T=a(n(193)),E=a(n(60)),O=a(n(2582)),M=a(n(1581)),_=a(n(1156)),I=a(n(2585)),k=a(n(2586)),A=a(n(2222)),N=a(n(1150)),P=a(n(509)),w=a(n(2224)),R=a(n(2594)),F=a(n(2595)),L=a(n(2597)),B=a(n(2226)),j=a(n(2606)),U=!1,D=function(e){function t(e){s(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={activeTab:null,commenting:!1,enableRelatedTags:!1,enhancedLink:!1,enhancedLinkRemoved:!1,errorStatus:null,guidelinesViewed:!1,posting:!1,titleHovered:!1,validComment:!1},(0,p.default)(this,["handleBlur","handleClickGuidelines","handleClickRecommendedTag","handleCloseCommentForm","handleFocus","handleHeartbeatInterval","handleKeyUp","handleLinkUpdate","handlePaste","handlePost","handleRelatedTags","handleRemoveRelatedTags","handleShowRecommendedTags","handleShowTumblrStickers","handleSubmit","handleTitleClick","handleUserIdle","onKeyDown","onTitleHover"])}return o(t,e),l(t,[{key:"componentWillMount",value:function(){var e=this.context;this.canvassStore=e.getStore(x.default),this.commentFormStore=e.getStore(S.default)}},{key:"componentDidMount",value:function(){var e=this;e.setState({guidelinesViewed:(0,n(191).readLocalStorage)(e.context,"gv",!1)}),e.handleCommentChanged(!!e.getCommentText()),e.props.isProfileLoaded||e.context.executeAction(M.default),setImmediate(function(){e.handleReplyFormInFocus()})}},{key:"componentWillUnmount",value:function(){this.setCommentingState(!1),clearTimeout(this.heartbeat),clearTimeout(this.userIdleTimer),this.commentFormStore.setFormInactive(this.props)}},{key:"getCommentText",value:function(){return(((0,n(10).findDOMNode)(this.refs.commentText)||{}).value||"").trim()}},{key:"handleCloseCommentForm",value:function(){this.props.handleCloseCommentForm()}},{key:"handleReplyFormInFocus",value:function(){var e=this.props,t=e.isSignedIn?(0,n(10).findDOMNode)(this.refs.commentText):(0,n(10).findDOMNode)(this.refs.loginPrompt);e.replyFormInFocus&&t&&(t.focus(),setTimeout(function(){t.blur(),t.focus()},1e3))}},{key:"componentDidUpdate",value:function(){this.handleReplyFormInFocus()}},{key:"componentWillReceiveProps",value:function(e){var t=e.enhancedLink,a=e.commentForm,s=e.forReply,o=this.refs.submit,r=this.props,i=!r.isHidden&&e.isHidden;if(o&&this.state.posting&&!a.errorMessage&&(s&&a.messageId===r.messageId&&a.replyId||!s&&a.messageId&&!a.replyId)){var l=o.getI13nNode().getMergedModel();l.msg_id=a.replyId||a.messageId,l.rcv_msg_id=a.replyId?a.messageId:null,l.animated_gif_count=(0,g.default)(a,["details","imageMessageDetails","length"])||0,l.smartlink_count=(0,g.default)(a,["details","linkMessageDetails","length"])||0,l.tags_count=a.tags.length,(0,n(1268).fireRapidClick)(l),i=!0}this.setState({posting:!1}),a.messageId===r.messageId&&"CANVASS_NETWORK_ERROR"===a.errorMessage&&(this.setState({errorStatus:"CANVASS_NETWORK_ERROR"}),i=!1,this.commentFormStore.initialize()),t.messageId===r.messageId&&t.title&&!(0,h.default)(t,r.enhancedLink)&&(this.handleLinkUpdate(t,!1),this.context.getStore(C.default).initialize(),i=!1),e.handleCloseCommentForm&&i&&e.handleCloseCommentForm()}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&"tumblrStickers"===this.state.activeTab&&this.setState({activeTab:null})}},{key:"toggleActiveTab",value:function(e){var t=this.state,n=t.activeTab!==e?e:null;this.setState({activeTab:n,enhancedLink:!1}),this.setCommentingState(!!n||t.validComment)}},{key:"enhanceLink",value:function(e){var t=this.props,a=this.state,s=t.configStoreState;if(!a.enhancedLinkRemoved&&!a.enhancedLink&&"tumblrStickers"!==a.activeTab){var o=(0,n(191).matchLinks)(e);o&&this.context.executeAction(O.default,{url:o[0],messageId:t.messageId,lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret})}}},{key:"handleShowTumblrStickers",value:function(){(0,n(10).findDOMNode)(this.refs.commentText).focus(),this.toggleActiveTab("tumblrStickers")}},{key:"handleLinkUpdate",value:function(e,t){this.getCommentText()||(t=!1),this.setState({activeTab:e&&"linkPreview",enhancedLink:e,enhancedLinkRemoved:t})}},{key:"handleFocus",value:function(){var e=this.state.activeTab;e||U||!(0,g.default)(this.context,["componentConfig","ui","tags","recommended","enabled"])||(e="recommendedTags",U=!0),this.commentFormStore.setActiveForm(this.props),this.setState({activeTab:e,errorStatus:null,posting:!1})}},{key:"handleBlur",value:function(){var e=this.props;e.replyFormInFocus&&e.handleReplyFormBlur()}},{key:"setCommentingState",value:function(e,t){var n=this.context,a=this.state.commenting!==e;if(a&&this.setState({commenting:e}),t||a){var s=(0,g.default)(n,["componentConfig","ui","presence","enabled"]),o=s||(0,g.default)(n,["componentConfig","ui","presence","heartbeat"]),r=this.props.configStoreState.notificationInterval;o&&r&&(e&&!this.heartbeat&&(this.heartbeat=setInterval(this.handleHeartbeatInterval,1e3*r)),n.executeAction(k.default,{context:n.context,eventType:e?"START_TYPING":"STOP_TYPING",namespace:this.props.messageNamespace||n.namespace}))}}},{key:"handleUserIdle",value:function(){this.setCommentingState(!1)}},{key:"handleHeartbeatInterval",value:function(){if(this.state.commenting){"visible"===(document&&document.visibilityState||"visible")&&this.context.renderTarget.isActive()?this.setCommentingState(!0,!0):this.setCommentingState(!1)}}},{key:"handleCommentChanged",value:function(e){this.props.configStoreState.notificationInterval&&e&&(clearTimeout(this.userIdleTimer),this.userIdleTimer=setInterval(this.handleUserIdle,6e4)),this.state.validComment!==e&&(this.setState({validComment:e}),this.setCommentingState(e))}},{key:"handlePaste",value:function(e){var t=e.clipboardData||e.originalEvent.clipboardData||window.clipboardData,n=t.getData("text");this.handleCommentChanged(this.state.validComment||!!n),this.props.configStoreState.allowSmartlinks&&n&&this.enhanceLink(n)}},{key:"handleKeyUp",value:function(e){var t=this.props.configStoreState.allowSmartlinks,n=e.target.value.trim();n||t&&this.state.enhancedLinkRemoved&&this.setState({enhancedLinkRemoved:!1}),t&&32===e.keyCode&&this.enhanceLink(n),this.handleCommentChanged(!!n)}},{key:"handlePost",value:function(e,t){var a=this.context,s=this.props,o=(0,n(10).findDOMNode)(this.refs.commentText),r=o.value.trim(),i=this.state.enhancedLink;if(!r&&!i&&!e)return void this.setState({errorStatus:"CANVASS_MISSING_COMMENT"});this.setState({activeTab:null,commenting:!1,posting:!0,validComment:!1}),this.handleLinkUpdate(!1,!1),this.context.executeAction(I.default,{author:t,content:r,context:a.contextId||a.context,contextDisplayText:a.contextDisplayText,contextUrl:a.contextUrl,enhancedLink:i,forReply:s.forReply||!1,instanceId:a.instanceId,isUserMessageHistory:a.isUserMessageHistory,mentions:s.mentions,messageId:s.messageId,messageNamespace:s.messageNamespace||"",namespace:a.namespace,parentContextDisplayText:s.parentContextDisplayText||"",replyId:s.replyId,sticker:e}),o.value=""}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.handlePost()}},{key:"renderErrorBox",value:function(){return this.state.errorStatus?d.default.createElement("div",{className:"error-box C(#ff333c) Pstart(12px) Pb(10px)"},d.default.createElement(n(30).Icon,{name:"attention",width:16,height:16,color:"#ff333c",className:"D(ib) Va(tb)! Mend(7px)"}),d.default.createElement(n(28).FormattedMessage,{id:this.state.errorStatus})):null}},{key:"renderLoadingBox",value:function(){return this.state.posting?d.default.createElement("div",{className:"H(100%) Bg(bgLoading) Op(0.7) C(#878c91) Bgz(35px) Pos(a) B(0) W(100%) Z(1)"}):null}},{key:"renderLoginPrompt",value:function(){var e=this.props;if(e.isFullScreen)return null;if(e.isReadOnly)return this.renderCommentsTitle();var t=e.deepLink,a=e.forReply,s=a?"CANVASS_SIGN_IN_POST_REPLY":"CANVASS_SIGN_IN_POST_COMMENT",o=(0,m.default)({"Mt(18px)":a,"Mb(15px)":!a||"createdAt"===e.replySort,"Mend(15px)":t&&!t.replyId}),r=(0,n(1690).getLoginUrl)(this.context);return d.default.createElement("div",{className:o},this.renderCommentsTitle(),this.renderRelatedTags(),d.default.createElement(n(17).I13nAnchor,{className:"comment-form D(ib) Bxz(bb) W(100%) P(6px) Bds(s) Bdw(1px) Bdc(#e2e2e2) Fz(13px) C(#188fff) O(n)",target:"_top",ref:"loginPrompt",rel:"noopener noreferrer",href:r,onBlur:this.handleBlur,onFocus:this.handleFocus,i13nModel:(0,n(1268).getI13nModel)("login",this.getI13nModel())},d.default.createElement("span",{className:"label D(ib) Va(m) Fw(500) Pstart(8px)"},d.default.createElement(n(28).FormattedMessage,{id:s}))))}},{key:"renderRelatedTags",value:function(){var e=this.props,t=this.state.enableRelatedTags;return t&&e.commentsExpanded&&!e.readOnly?d.default.createElement(P.default,{component:"div",transitionName:"action",transitionAppear:!0,transitionAppearTimeout:250,transitionEnterTimeout:250,transitionLeaveTimeout:250},d.default.createElement(F.default,{enableRelatedTags:t,handleRemoveRelatedTags:this.handleRemoveRelatedTags,relatedTags:e.relatedTags,selectedTags:e.selectedTags})):null}},{key:"handleRemoveRelatedTags",value:function(){this.canvassStore.resetRelatedTags(this.context.instanceId),this.setState({enableRelatedTags:!1}),this.context.handleOverlay(!1)}},{key:"handleRelatedTags",value:function(){var e=this.props,t=this.context,a=e.configStoreState;t.handleOverlay(!0),this.setState({enableRelatedTags:!0}),this.context.executeAction(_.default,{context:t.context,instanceId:t.instanceId,lang:a.lang,namespace:t.namespace,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret,region:a.region,tagsAnd:(0,n(191).joinFilterTags)(t.tagsAnd,e.selectedTags),tagsOr:t.tagsOr})}},{key:"handleTitleClick",value:function(){var e=this.props;e.enableTitleClick&&e.count>0&&e.onTitleClick&&e.onTitleClick()}},{key:"onTitleHover",value:function(){this.props.enableTitleClick&&this.setState({titleHovered:!this.state.titleHovered})}},{key:"getHeading",value:function(){var e=this.props,t=e.count,n=this.context,a=n.intl,s=n.contextDisplayText,o=n.componentConfig.ui.showContextDisplayText,r=a.formatNumber(t),i="";if(e.commentsExpanded)switch(t){case 0:i=a.formatMessage({id:"CANVASS_BE_THE_FIRST"});break;case 1:i=o&&s?a.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE_WITH_TITLE"},{title:s}):a.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE"});break;default:i=o&&s?a.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE_WITH_TITLE"},{count:r,title:s}):a.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE"},{count:r})}else i=t?a.formatMessage({id:"CANVASS_VIEW_COMMENTS"},{count:r}):a.formatMessage({id:"CANVASS_BE_THE_FIRST"});return i}},{key:"renderHeading",value:function(){var e=(0,m.default)("comments-title D(ib) Cur(p) Td(n)",{"C(#188fff)":this.state.titleHovered,"C(#000)":!this.state.titleHovered}),t=this.props.commentsExpanded?"hide":"show";this.props.count||(t="start");var a={elm:"cmmt_open",slk:t};return d.default.createElement(n(17).I13nAnchor,{className:e,onClick:this.handleTitleClick,onMouseEnter:this.onTitleHover,onMouseLeave:this.onTitleHover,i13nModel:a},d.default.createElement(n(30).Icon,{asset:N.default,className:"comment-icon Va(m)! D(ib) Mend(7px)",color:this.state.titleHovered?"#188fff":"#000",height:21,width:21}),this.getHeading())}},{key:"renderCommentsTitle",value:function(){var e=this.props;if(e.forReply)return null;var t=e.configStoreState,a=e.isReadOnly,s=e.sentiments,o=t.enableSentiments&&s&&s.size?d.default.createElement(L.default,{className:"Fl(end) Fz(13px) Fw(n) Whs(nw) Pos(r) Cur(p) Z(1)",sentiments:s}):null;return d.default.createElement("div",{className:(0,m.default)("comment-heading Pend(6px) Fw(b) Fz(16px) C(#000)",{"Py(15px)":!a,"Pt(15px)":a})},d.default.createElement("div",{className:"D(ib)"},this.renderHeading(),t.enableRelatedTags&&e.commentsExpanded?d.default.createElement(n(17).I13nButton,{type:"button",onClick:this.handleRelatedTags,className:"related-tags-add-btn Mstart(5px)! Cur(p) O(n) Va(t) P(0) M(0) Bd(n)"},d.default.createElement(n(30).Icon,{className:"Cur(p) Va(m)!",name:"plus-circle",width:15,height:15,color:"#188fff"})):null),o)}},{key:"renderActiveTab",value:function(){switch(this.state.activeTab){case"linkPreview":return d.default.createElement(w.default,{enhancedLink:this.state.enhancedLink,onLinkUpdate:this.handleLinkUpdate,fromStream:!1,isUserMessageHistory:this.context.isUserMessageHistory});case"tumblrStickers":return d.default.createElement(j.default,{onStickerClick:this.handlePost});case"recommendedTags":return d.default.createElement(R.default,i({forReply:this.props.forReply,handleClickTag:this.handleClickRecommendedTag,tags:this.canvassStore.getCommentsState(this.context.instanceId).get("recommendedTags")},(0,g.default)(this.context,["componentConfig","ui","tags","recommended"])));default:return null}}},{key:"getI13nModel",value:function(){var e=this.props;return{cpos:e.forReply?e.cpos:null,reply_lv:e.replyId?2:e.forReply?1:0}}},{key:"handleShowRecommendedTags",value:function(){U=!0,this.toggleActiveTab("recommendedTags")}},{key:"handleClickRecommendedTag",value:function(e){var t=(0,n(10).findDOMNode)(this.refs.commentText);if(t){var a=this.getCommentText(),s=e?"#"+e+" ":"#";t.value=a?a+" "+s:s,t.focus(),this.handleCommentChanged(!0)}this.handleShowRecommendedTags()}},{key:"renderUploadOptions",value:function(){var e=this.state.activeTab,t=this.context,a=this.props,s=a.configStoreState.allowAnimatedGIF,o=this.canvassStore.getCommentsState(t.instanceId).get("recommendedTags"),r=(0,g.default)(t,["componentConfig","ui","tags","recommended","enabled"])&&o&&o.size>0,i="recommendedTags"===e?"C(#188fff)":"C(#878c91)",l="tumblrStickers"===e?"#188fff":"#878c91",c=f.default.dedupe("Pos(r)",{"Pstart(16px) Pb(10px)":!a.isFullScreen,"D(n)":!s,"Pstart(10px)":a.forReply}),u="tumblrStickers"===e?{slk:"gif hide",outcm:"hide"}:{slk:"gif show",outcm:"show"};return d.default.createElement("div",{className:c},s?d.default.createElement(n(17).I13nButton,{"aria-label":t.intl.formatMessage({id:"CANVASS_SHOW_GIFS"}),className:"Va(m) O(n) P(0) M(0) Bd(n)",i13nModel:(0,n(1268).getI13nModel)("tumblr-icon",u),onClick:this.handleShowTumblrStickers,type:"button"},d.default.createElement(n(30).Icon,{name:"gif",height:23,color:l})):null,r?d.default.createElement(n(17).I13nButton,{"aria-label":t.intl.formatMessage({id:"CANVASS_SHOW_RECOMMENDED_TAGS"}),className:"Va(m) O(n) P(0) M(0) Bd(n) Fw(b) Fz(20px) Mstart(20px) "+i,i13nModel:{elm:"cmmt_tags",slk:"tags show"},onClick:this.handleShowRecommendedTags,type:"button"},"#"):null)}},{key:"renderSubmitButton",value:function(){var e=this.props,t=e.forReply,a=e.isFullScreen,s=this.state,o=s.validComment,r=s.enhancedLink,i=this.renderGuidelinesLink(),l=this.state.enhancedLink?{elmt:"link",elm:"cmmt_post"}:{elmt:"text",elm:"cmmt_post"},c=(0,m.default)("comment-submit Fw(600) Bgc(t) Bd(n) O(n) M(0)",{"Pos(a) End(0) B(0)":!i,"Pt(6px) Px(12px)":a,"P(12px)":!a,"Fz(14px)":t||a,"Fz(16px)":!t&&!a,"C(#188fff)":o||r,"C(#e0e4e9)":!o&&!r}),u=d.default.createElement(n(17).I13nButton,{bindClickEvent:!1,className:c,i13nModel:(0,n(1268).getI13nModel)(t?"reply-post":"comment-post",l),ref:"submit",type:"submit"},this.context.intl.formatMessage({id:t?"CANVASS_REPLY":"CANVASS_POST"}));return i?d.default.createElement("div",{className:"Pos(a) End(0) B(0)"},i,u):u}},{key:"handleClickGuidelines",value:function(){(0,n(191).writeLocalStorage)(this.context,"gv",!0),this.setState({guidelinesViewed:!0})}},{key:"renderGuidelinesLink",value:function(){var e=this.context,t=e.componentConfig&&e.componentConfig.guidelineUrl;if(this.state.guidelinesViewed&&t)return d.default.createElement(n(17).I13nAnchor,{className:"C(#9ea2af) Fz(14px) Mend(5px)",href:t,i13nModel:(0,n(1268).getI13nModel)("guidelines"),target:"_blank"},e.intl.formatMessage({id:"CANVASS_GUIDELINES"}))}},{key:"renderGuidelinesMessage",value:function(){var e=this.context,t=e.componentConfig&&e.componentConfig.guidelineUrl;if(this.props.isActive&&!this.state.guidelinesViewed&&t){var a=this.props,s=a.forReply,o=a.isFullScreen;return d.default.createElement("div",{className:(0,m.default)("Fz(14px) BdB Bdc(#e0e4e9)",{"Ta(c) Mb(5px) Pb(8px)":o&&!s,"Bgc(#f7f8ff) Px(16px) Py(10px)":!o||s})},d.default.createElement(n(28).FormattedMessage,{id:"CANVASS_REVIEW_GUIDELINES",values:{guidelines:d.default.createElement(n(17).I13nAnchor,{className:"C(#188fff) Fw(b)",href:t,i13nModel:(0,n(1268).getI13nModel)("guidelines"),onClick:this.handleClickGuidelines,target:"_blank"},e.intl.formatMessage({id:"CANVASS_GUIDELINES"}))}}))}}},{key:"renderTextArea",value:function(){var e=this.props,t=e.configStoreState,n=e.deepLink,a=e.forReply,s=e.messageId,o=e.isFullScreen,r=e.value,i=t.allowAnimatedGIF,l=t.enableRelatedTags,c=t.allowSmartlinks,u=this.context.intl,p="smartphone"===(0,g.default)(this.context,["session","dimensions","device"]),m=f.default.dedupe("Bd(n) Fz(14px) Lh(20px) W(100%) Bxsh(n) C(#26282a)",{"Pstart(16px) Py(12px)":!o,"Pstart(10px) Pt(10px)":a}),h=void 0;h=a?"CANVASS_POST_REPLY":i&&l&&c?p?"CANVASS_POST_COMMENT_SMARTPHONE_LONG":"CANVASS_POST_COMMENT_LONG":"CANVASS_POST_COMMENT";var v=u.formatMessage({id:h}),y=f.default.dedupe("Pos(r) Ov(h) Bgc(#fff)",{"Mend(8px)":n,"My(13px) Bdc(#e0e4e9) Bd Bdrs(2px)":!o,"Mt(8px) Mb(10px)":o,"Mstart(40px) Mt(16px) Mb(13px)":a,"Mstart(52px)":!a});return d.default.createElement("div",{className:y},this.renderGuidelinesMessage(),d.default.createElement(B.default,{ref:"commentText",className:m,key:"textarea-"+s,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,placeholder:v,rows:1,tabIndex:"1",value:r}),this.renderLoadingBox(),this.renderActiveTab(),this.renderUploadOptions(),this.renderSubmitButton())}},{key:"renderForm",value:function(){var e=this.props,t=e.isFullScreen,a=e.isReadOnly,s=e.userProfile,o=f.default.dedupe("Pos(r)",{"Mx(10px)":t}),r=d.default.createElement(n(17).I13nDiv,{className:o,i13nModel:this.getI13nModel()},t?void 0:this.renderCommentsTitle(),t?void 0:this.renderRelatedTags(),a?void 0:d.default.createElement(A.default,{creator:e.guid,fromCommentForm:!0,imageUrl:s.imageUrl,isReply:e.forReply,key:"byline-commentform"+e.messageId,name:s.nickName}),a?void 0:d.default.createElement("form",{className:"Ov(h) W(100%) Cf",encType:"multipart/form-data",onKeyDown:this.onKeyDown,onSubmit:this.handleSubmit,ref:"form"},this.renderTextArea(),this.renderErrorBox()));return t?d.default.createElement("div",{className:"Pos(f) Bgc(#fff) Z(1) B(0) Start(0) End(0) BdT Bdc(#e0e4e9)"},r):r}},{key:"render",value:function(){return this.props.isHidden?null:this.props.isSignedIn?this.renderForm():this.renderLoginPrompt()}}]),t}(n(1).PureComponent);t.CommentForm=D,D.contextTypes={componentConfig:u.default.object.isRequired,configStoreState:u.default.object.isRequired,context:u.default.string,contextDisplayText:u.default.string,contextId:u.default.string,contextUrl:u.default.string,executeAction:u.default.func.isRequired,getStore:u.default.func,handleOverlay:u.default.func,instanceId:u.default.string,intl:u.default.object.isRequired,isUserMessageHistory:u.default.bool,localStorage:u.default.object,namespace:u.default.string,renderTarget:u.default.object.isRequired,session:u.default.object.isRequired,tags:u.default.string,tagsAnd:u.default.string,tagsOr:u.default.string},D.defaultProps={commentsExpanded:!0},t.default=(0,y.default)(D,[E.default,T.default,C.default,S.default,b.default],r)},2224:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1561)),d=a(n(1335)),f=a(n(26)),p=a(n(283)),m=a(n(2227)),g=a(n(105)),h=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,d.default)(this,["handleClick","handleImgError","handleRemoveImage"])}return o(t,e),r(t,[{key:"handleRemoveImage",value:function(e){this.props.onLinkUpdate(!1,!0),(0,n(1268).fireRapidClick)({slk:"link-prvw-close",elm:"cmmt_link",itc:1,outcm:"close"}),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},{key:"handleImgError",value:function(e){e.target.classList.add("D(n)!")}},{key:"handleClick",value:function(){var e=this.props,t=e.enhancedLink;if(e.fromStream){var a=this.context.i13n.getI13nNode().getMergedModel();a.slk="smartlink",a.elm="cmmt_link",a.itc=0,a.outcm="navigate",(0,n(1268).fireRapidClick)(a),t.url&&window.open(t.url)}}},{key:"renderImg",value:function(){var e=this.props.enhancedLink,t=(0,f.default)(e,["image","url"],null);return t&&c.default.createElement(m.default,null,c.default.createElement("img",{alt:e.title,className:"D(b) Bxz(bb) Mih(100px) Mah(200px) Maw(145px) W(a) Mend(5px) P(5px) Fl(start) Maw(n)--xxs W(100%)--xxs Fl(n)--xxs",onError:this.handleImgError,src:t}))}},{key:"render",value:function(){var e=this.props,t=e.enhancedLink,a=e.fromStream,s=this.context,o=s.contextId,r=s.tags;if(!t)return null;var i=t.title,l=void 0===i?"":i,d=t.description,f=void 0===d?"":d,m=t.url,h=m.indexOf("://")>-1?m.split("/")[2]:m.split("/")[0];a||(0,n(1268).fireRapidEvent)("secvw",{slk:"link-prvw-"+m,elm:"cmmnt_link",itc:1,outcm:"show",cat:r,context:o});var v=u.default.dedupe("Cf Bxsh(boxShadow) Mx(14px) panel Pos(r) Miw(150px) Lh(14px) Bgc(#fff) Bg(#fff) Bdrs(3px) Bdc(#d9d9d9) Bds(s) Bdw(1px) Mb(10px)",{"Cur(p) Mx(0) Mb(5px)":a});return c.default.createElement(n(17).I13nDiv,{bindClickEvent:!1,className:v,onClick:this.handleClick},this.renderImg(),c.default.createElement("div",{className:"P(5px)"},!1===a?c.default.createElement(n(17).I13nButton,{className:"Pos(a) End(-10px) T(-10px) Bgc(#000) Op(0.8) Bdrs(50%) M(0) P(0) W(21px) H(21px)",i13nModel:(0,n(1268).getI13nModel)("link-prvw-close"),onClick:this.handleRemoveImage},c.default.createElement(n(30).Icon,{asset:g.default,width:13,height:13,color:"#ffffff",className:"Va(bl)!"})):null,c.default.createElement("div",{className:"LineClamp(2,54px) Fz(16px) Pt(5px) C(#020e65) Lh(18px) Mah(54px) Fw(500) Ov(h) Tov(e)"},p.default.decode(l)),c.default.createElement("div",{className:"LineClamp(2,42px) D(n)!--xxs Fz(13px) Mt(10px) Lh(14px) Mah(42px) Ov(h) Tov(e)"},p.default.decode(f)),c.default.createElement("div",{className:"Fz(11px) Td(n) Fw(n) D(ib) Mt(5px)!--xxs Mt(10px) Ell"},h)))}}]),t}(n(1).PureComponent);h.contextTypes={configStoreState:l.default.object,contextId:l.default.string,cpos:l.default.number,i13n:l.default.object,isUserMessageHistory:l.default.bool,pos:l.default.number,tags:l.default.string,userMessageHistoryGuid:l.default.string},t.default=h,e.exports=t.default},2225:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1335)),d=a(n(5)),f=a(n(1389)),p=(a(n(26)),a(n(500))),m=a(n(501)),g=a(n(2038)),h=a(n(105)),v=a(n(1146)),y=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,u.default)(this,["handleClickOutside","handleFilterClick","handleShowMyComments"]),this.state={menuOpen:!1}}return o(t,e),r(t,[{key:"handleClickOutside",value:function(e){this.setState({menuOpen:!1})}},{key:"handleFilterClick",value:function(e){e&&e.stopPropagation(),this.setState({menuOpen:!this.state.menuOpen})}},{key:"handleShowMyComments",value:function(){var e=this.props,t=e.currentUserProfile;this.context.handleUserMessages(e.currentUserGuid,t.imageUrl,t.nickName)}},{key:"handleSort",value:function(e,t){var n=this.context,a=this.props,s=t||[];if(a.sortBy!==e||t!==a.selectedTags){var o=n.instanceId,r=n.userMessageHistoryGuid,i=r?g.default:m.default,l=void 0;l=r?{guid:r,name:a.userMessageHistoryName,image:a.userMessageHistoryImage,sortBy:e,instanceId:o}:{instanceId:o,sortBy:e,tagsAnd:n.tagsAnd,tagsOr:n.tagsOr,selectedTags:s.join(","),context:n.context,contextUrl:n.contextUrl,contextDisplayText:n.contextDisplayText},this.context.executeAction(i,l)}}},{key:"getSortLabel",value:function(e){switch(e){case f.default.SORT_HIGHEST_RATED:return c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_SORT_HIGHEST_RATED"});case f.default.SORT_LATEST:return c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_SORT_NEWEST"});case f.default.SORT_NEWEST:return c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_SORT_RECENT"});case f.default.SORT_OLDEST:return c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_SORT_OLDEST"});case f.default.SORT_MOST_REPLIED:return c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_SORT_MOST_REPLIED"});default:return null}}},{key:"getI13nOverride",value:function(e){return{slk:e}}},{key:"renderSortOptions",value:function(){if(this.state.menuOpen)return c.default.createElement("ul",{className:"sorting-tabs Pos(a) Z(1) Bd Bdc(#e0e4e9) Bdrs(3px) Bgc(#fff) Bxsh(boxShadow) Mt(8px)"},this.props.arrangement.map(this.renderSortOption,this))}},{key:"renderSortOption",value:function(e){var t=e===this.props.sortBy,a=this.getSortLabel(e);if(!a)return null;var s=(0,d.default)("H(44px)",{selected:t});return c.default.createElement("li",{className:s,key:e},c.default.createElement(n(17).I13nButton,{className:"sort-by-"+e+" Px(16px) Py(12px) O(n) Cur(p) C(#878c91) Fz(14px) Fw(500) C(#188fff):h selected_C(#188fff) selected_Fw(b)",onClick:this.handleSort.bind(this,e,this.props.selectedTags),i13nModel:(0,n(1268).getI13nModel)("sort",this.getI13nOverride(e))},a,c.default.createElement("span",{className:"Hidden"},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_COMMENTS"}))))}},{key:"handleClickSelectedTag",value:function(e){var t=this.props,n=t.selectedTags,a=void 0===n?[]:n,s=t.sortBy;a=a.filter(function(t){return t!==e}),this.handleSort(s,a)}},{key:"renderSelectedTags",value:function(){var e=this.props,t=e.selectedTags,a=e.selectedTagsCount,s=t&&t.size;if(s>0)return c.default.createElement("div",{className:"D(ib)"},t.map(function(e,t){return c.default.createElement(n(17).I13nButton,{className:"Fz(12px) Fw(500) Lh(1) P(4px) Pstart(8px) Bdrs(4px) Mend(8px) C(#fff) Bgc(#188fff)",i13nModel:{elm:"cmmt_tag",pos:s-1,slk:e},key:"tag-"+t,onClick:this.handleClickSelectedTag.bind(this,e)},"#"+e,c.default.createElement("span",{className:"Fw(n) D(ib) Mx(4px)"},"("+this.context.intl.formatNumber(a)+")"),c.default.createElement(n(30).Icon,{asset:h.default,color:"#fff",height:14,style:{verticalAlign:"text-bottom"},width:14}))},this))}},{key:"renderMyCommentsButton",value:function(){var e=this.context,t=this.props;if(t.myComments&&t.currentUserGuid&&t.currentUserProfile&&!e.isUserMessageHistory)return c.default.createElement(n(17).I13nButton,{className:"my-comments-button O(n) Fz(14px) Fw(600) C(#26282a) M(0) P(0) Fl(end)",i13nModel:(0,n(1268).getI13nModel)("user-comments-tap",{t1:t.guid,t2:0}),onClick:this.handleShowMyComments},e.intl.formatMessage({id:"CANVASS_MY_COMMENTS"}))}},{key:"render",value:function(){var e=this.props,t=e.arrangement,a=e.count,s=e.sortBy;return a<2||Object.keys(t).length<2?null:c.default.createElement("div",{className:"sorting-tabs-container Pos(r) Mt(5px)",onClick:this.handleClickOutside},c.default.createElement(n(17).I13nButton,{className:"sort-filter-button O(n) Fz(14px) Fw(600) C(#26282a) M(0) P(0)",i13nModel:(0,n(1268).getI13nModel)("sort-btn",this.getI13nOverride(s)),onClick:this.handleFilterClick},this.getSortLabel(s),c.default.createElement(n(30).Icon,{asset:v.default,className:"Mstart(5px) Mend(13px)",color:"#26282a",width:10,height:10,style:{verticalAlign:"middle"}})),this.renderSortOptions(),this.renderSelectedTags(),this.renderMyCommentsButton())}}]),t}(n(1).PureComponent);y.contextTypes={configStoreState:l.default.object.isRequired,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,handleUserMessages:l.default.func,instanceId:l.default.string,intl:l.default.object,isUserMessageHistory:l.default.bool,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string,userMessageHistoryGuid:l.default.string},y.defaultProps={arrangement:[],count:0,sortBy:"popular"},t.default=(0,p.default)(y),e.exports=t.default},2226:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},c=a(n(0)),u=a(n(1)),d=a(n(1335)),f=(0,n(17).createI13nNode)("textarea",{bindClickEvent:!0}),p=function(e){function t(e){s(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,d.default)(this,["onKeyDown"]),this.state={height:"auto",rows:this.props.rows}}return o(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this.props.value,t=e&&e.length;if(t){var a=(0,n(10).findDOMNode)(this);a&&(a.value=e,a.setSelectionRange&&a.setSelectionRange(t,t))}}},{key:"onKeyDown",value:function(e){if("Enter"===e.key&&this.setState({rows:this.state.rows+1}),"Backspace"===e.key&&1!==this.state.rows){var t=e.target.value.split("\n");t[t.length-1]||this.setState({rows:this.state.rows-1})}}},{key:"render",value:function(){var e=Object.assign({},this.props);return delete e.hasAutoExpand,delete e.value,u.default.createElement(f,r({},e,{i13nModel:(0,n(1268).getI13nModel)("text-input",{context:this.context.context,cat:this.context.tags}),onKeyDown:this.onKeyDown,ref:"textarea",rows:this.state.rows,style:{resize:"none"}}))}}]),t}(n(1).PureComponent);p.defaultProps={className:"text-area",hasAutoExpand:!0},p.contextTypes={context:c.default.string,tags:c.default.string},t.default=p,e.exports=t.default},2227:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}};t.default=function(e){function t(e){a(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={shouldRender:!1}}return s(t,e),o(t,[{key:"componentDidMount",value:function(){this.setState({shouldRender:!0})}},{key:"render",value:function(){return this.state.shouldRender?this.props.children:null}}]),t}(n(1).Component),e.exports=t.default},2228:function(e,t,n){"use strict";e.exports=n(16)({storeName:"CanvassLinkEnhancerStore",statics:{handlers:{CANVASS_GET_ENHANCE_URL_SUCCESS:"canvassEnhancedLinkSuccess"}},initialize:function(){this.state={}},canvassEnhancedLinkSuccess:function(e){this.state=e.data,this.state.messageId=e.messageId,this.emitChange()},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}})},2229:function(e,t,n){"use strict";e.exports=n(291)({storeName:"CanvassSentimentsStore",handlers:{CANVASS_GET_SENTIMENTS_SUCCESS:"_getSentimentsSuccess"},initialize:function(){this._state=n(6).fromJS({sentiments:{}})},_getSentimentsSuccess:function(e){e.instanceId&&e.sentiments&&this.mergeState(this._state.setIn(["sentiments",e.instanceId],n(6).fromJS(e.sentiments)))},getSentiments:function(e){return this._state.getIn(["sentiments",e],n(6).List())}})},2282:function(e,t,n){e.exports=n(569)(n(2833))},2535:function(e,t){if(void 0===n)var n={};n.reply={name:"reply",height:20,width:25,path:"M12.8 5.8V2.4c0-.4-.2-.7-.6-.8-.3-.2-.8-.1-1.1.1L.9 8.8c-.2.2-.4.4-.4.7s.2.6.4.8l10.2 7.1c.3.2.7.3 1.1.1.3-.2.6-.5.6-.8v-3.3h1.3c3 0 6.1.6 8.5 5.2.2.3.5.5.9.5h.3c.5-.1.8-.6.7-1C23 7.3 18.5 5.9 12.8 5.8zm-.1 5.6h-1c-.6 0-1 .4-1 .9v2.4L3.2 9.5l7.5-5.2v2.4c0 .5.5.9 1 .9 4.2 0 7.9 0 9.8 6.3-2.9-2.6-6.3-2.6-8.8-2.5z"},void 0!==e&&e.exports&&(e.exports=n.reply)},2580:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.getStore(n(189)).getState(),o=Object.assign({lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},t);e.service.create("canvass.blockUser",o,{},function(t,n){if(t||!n||n.error)return e.dispatch("CANVASS_BLOCK_FAILURE",t),a();e.dispatch("CANVASS_BLOCK_SUCCESS",o),a()})}},2581:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=t.replyId?"canvass.deleteReply_ns":"canvass.deleteMessage_ns",o=e.getStore(n(189)).getState(),r=Object.assign({lang:o.lang,region:o.region,oauthConsumerKey:o.oauthConsumerKey,oauthConsumerSecret:o.oauthConsumerSecret},t);e.service.delete(s,r,{},function(t,n){if(t||!n||n.error)return e.dispatch("CANVASS_DELETE_FAILURE",t),a();e.dispatch("CANVASS_DELETE_SUCCESS",r),a()})}},2582:function(e,t,n){"use strict";e.exports=function(e,t,n){e.service.read("canvass.smartlinks",t,{},function(a,s){if(a||!s||s.error)return e.dispatch("CANVASS_GET_ENHANCE_URL_FAILURE",a),n();e.dispatch("CANVASS_GET_ENHANCE_URL_SUCCESS",{data:s,messageId:t.messageId}),n()})}},2583:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=t.isUserMessageHistory,o=t.instanceId,r=t.sortBy,i=e.getStore(n(189)).getState(),l=Object.assign({lang:i.lang,region:i.region,namespace:i.namespace,oauthConsumerKey:i.oauthConsumerKey,oauthConsumerSecret:i.oauthConsumerSecret},t);delete l.isTopComments,delete l.isUserMessageHistory,delete l.instanceId,e.service.read("canvass.getReplies_ns",l,{},function(n,i){if(n||!i||i.error)return e.dispatch("CANVASS_REPLIES_FAILURE",n),a();var c=i,u=c.length,d={instanceId:o,isTopComments:t.isTopComments,isUserMessageHistory:s,messageId:l.messageId,sortBy:r};"createdAt"===r?c=c.reverse():"createdAtDesc"===r&&(d.nextIndex=u===l.count?c[u-1].index:null),d.replyList=c,e.dispatch("CANVASS_REPLIES_SUCCESS",d),a()})},e.exports.displayName="loadReplies"},2584:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=t.instanceId,o=e.getStore(n(189)).getState();if(!s||!o.oauthConsumerSecret||!o.oauthConsumerKey)return a("Required fields missing",null);var r=e.getStore(n(187)).getCommentsState(s),i={context:t.context||"YahooGlobal",lang:o.lang,region:o.region,namespace:t.namespace||r.get("namespace")||o.namespace,oauthConsumerKey:o.oauthConsumerKey,oauthConsumerSecret:o.oauthConsumerSecret};e.service.read("canvass.getPresence_ns",i,{},function(t,n){if(t||!n)return e.dispatch("CANVASS_PRESENCE_FAILURE",{instanceId:s}),a&&a(t,null);e.dispatch("CANVASS_PRESENCE_SUCCESS",{instanceId:s,userActivity:n}),a&&a()})},e.exports.displayName="loadUserActivity"},2585:function(e,t,n){"use strict";function a(e){return e.mimeType="image/gif",e}e.exports=function(e,t,s){var o=e.getStore(n(189)).getState();t=Object.assign({lang:o.lang,region:o.region,namespace:o.namespace,oauthConsumerKey:o.oauthConsumerKey,oauthConsumerSecret:o.oauthConsumerSecret},t);var r=t.content,i=t.sticker,l=t.forReply,c=l?t.parentContextDisplayText:t.contextDisplayText,u=l?t.messageNamespace:t.namespace,d=t.enhancedLink,f="",p={userText:r,contextUrl:t.contextUrl,contextDisplayText:c,details:[],mentions:t.mentions||[],visibilityType:"PUBLIC"};if("IMAGE"===(f=i?"IMAGE":n(61)(d)?"TEXT":"LINK")){if(n(24)(i)&&i.length){var m=Object.assign({},i[0]);m.animated=!0,m=a(m),m.resolutions=i.map(a),p.details=[{type:"IMAGE",image:m,attribution:{name:t.author||"",source:"tumblr"}}]}}else"LINK"===f&&(delete d.messageId,p.details=[d]);p=JSON.stringify(p),e.service.create(l?"canvass.replyMessage_ns":"canvass.postMessage_ns",{context:t.context,messageId:t.messageId,namespace:u,lang:t.lang,region:t.region,oauthConsumerKey:t.oauthConsumerKey,oauthConsumerSecret:t.oauthConsumerSecret},p,{},function(n,a){if(n||!a||a.error)return e.dispatch("CANVASS_POST_FAILURE",t),s();a.inReplyTo=t.replyId,a.instanceId=t.instanceId,a.isUserMessageHistory=t.isUserMessageHistory,e.dispatch("CANVASS_POST_SUCCESS",a),s()})}},2586:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.getStore(n(189)).getState(),o=JSON.stringify({eventType:t.eventType}),r={context:t.context,eventType:t.eventType,namespace:t.namespace||s.namespace,lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret};e.service.create("canvass.sendHeartbeat_ns",r,o,{},function(t,n){t||!n||n.error?e.dispatch("CANVASS_HEARTBEAT_FAILURE",t):e.dispatch("CANVASS_HEARTBEAT_SUCCESS",r),a()})},e.exports.displayName="sendHeartbeat"},2587:function(e,t,n){"use strict";var a;e.exports=function(e,t,n){if(!parent||parent===window)return n&&n();var s=document.querySelector(".render-target-active")||document.scrollingElement||document.body,o=s.scrollHeight;o!==a&&(a=o,parent.postMessage(JSON.stringify({context:t.context,height:a,isCanvass:!0}),"*")),n&&n()}},2588:function(e,t,n){"use strict";e.exports=function(e,t,a){var s=e.getStore(n(189)).getState(),o=Object.assign({lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},t),r=t.search||"popular",i=e.getStore(n(2040)),l=i.get(["data",r]);if(l&&l.get("stickers")&&!t.offset)return e.dispatch("TUMBLR_RELOAD"),a();e.service.read("popular"===r?"canvass.getPopularGifs":"canvass.getGifs",o,function(n,s){!n&&s&&s.gifresult&&0!==s.gifresult.length?e.dispatch("TUMBLR_LOAD_GIFS",{key:r,data:s,offset:t.offset||0}):e.dispatch("TUMBLR_LOAD_GIFS_ERROR",{key:r,error:n,offset:t.offset||0}),a()})}},2589:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1805)),d=a(n(1335)),f=a(n(26)),p=a(n(500)),m=a(n(2580)),g=a(n(2581)),h=a(n(2221)),v=a(n(2226)),y=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,d.default)(this,["closeFlyout","handleAction","handleClickOutside","handleRadioChanged","handleReport","handleToggleFlyout","openFlyout"]),this.state={selectedAbuseOption:"",flyoutOpened:!1,reportOpened:!1}}return o(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;t.props.messageId!==e.messageId&&t.setState({flyoutOpened:!1,reportOpened:!1,selectedAbuseOption:""})}},{key:"handleRadioChanged",value:function(e){this.setState({selectedAbuseOption:e.currentTarget.value})}},{key:"handleReport",value:function(){var e=this.context,t=this.props,a=e.intl.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),s=this.state.selectedAbuseOption===a?(0,n(10).findDOMNode)(this.refs.reportText).value.trim():this.state.selectedAbuseOption;s?(e.executeAction(h.default,{abuseReason:s,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,voteType:"abuse"}),t.handleFeedbackMessage("flag")):this.setState({reportOpened:!1})}},{key:"handleDelete",value:function(){var e=this.context,t=this.props;e.executeAction(g.default,{context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId})}},{key:"handleBlockUser",value:function(){var e=this.context,t=this.props;e.executeAction(m.default,{blockedGuid:t.creator,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,userId:e.guid})}},{key:"handleClickOutside",value:function(e){this.closeFlyout()}},{key:"openFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"closeFlyout",value:function(){this.setState({flyoutOpened:!1})}},{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened})}},{key:"handleAction",value:function(e){var t=this.props,n=void 0!==t.delay?t.delay:2500;"flag"!==e&&(t.handleFeedbackMessage(e),setTimeout(function(){"delete"===e?this.handleDelete():"block"===e&&this.handleBlockUser()}.bind(this),n)),this.setState({flyoutOpened:!1,reportOpened:"flag"===e&&!this.state.reportOpened})}},{key:"renderFlyoutButton",value:function(e){var t="Pos(r) W(100%) H(a) Mih(36px) Z(1) Pend(14px) Bd Bdrs(3px) Bdc(#e0e4e9) Bxsh(boxShadowFlag) Cur(p) Py(6px) Pstart(8px) Fz(13px) C(#26282a) Bgc(#fff) Bgc(#f1f1f5):h flyout-button-"+e,a="D(ib) Ta(start) Wow(bw) Pstart(28px) "+("delete"===e?"W(100px)":"W(125px)"),s=this.context.intl,o=void 0;switch(e){case"delete":o=s.formatMessage({id:"CANVASS_DELETE_MESSAGE"});break;case"flag":o=s.formatMessage({id:"CANVASS_FLAG_MESSAGE"});break;case"block":o=s.formatMessage({id:"CANVASS_MUTE_MESSAGE"},{user:this.props.nickname})}return c.default.createElement(n(17).I13nButton,{onClick:this.handleAction.bind(this,e),i13nModel:(0,n(1268).getI13nModel)("comment-"+e),className:t},c.default.createElement("div",{className:"W(40px) D(ib) Pos(a) T(6px) Start(4px) W(100%)"},c.default.createElement(n(30).Icon,{name:e,className:"Pstart(8px) Pend(8px) Va(m)!",color:"#000",width:21,height:21})),c.default.createElement("div",{className:a},o))}},{key:"renderFlyout",value:function(){if(!this.state.flyoutOpened)return null;var e=this.props.creator===this.context.guid;return c.default.createElement("div",{className:"flyout Pos(a) T(0) End(25px) W(190px)"},this.renderFlyoutButton(e?"delete":"flag"),!e&&this.renderFlyoutButton("block"))}},{key:"renderFlagOption",value:function(e,t){var n=this.props.replyId||this.props.messageId,a="report-option-"+n+"-"+t,s=this.context.intl.formatMessage({id:e});return c.default.createElement("div",{className:"Mb(10px) flag-opts"},c.default.createElement("input",{id:a,onChange:this.handleRadioChanged,type:"radio",name:"options-"+n,className:"Mend(10px) Va(t)",value:s}),c.default.createElement("label",{htmlFor:a},s))}},{key:"renderOverflowButton",value:function(){var e=this;if(e.context.guid){var t=e.state.flyoutOpened?"#188fff":"#878c91",a="desktop"===(0,f.default)(e.context,["session","dimensions","device"]),s=a?null:e.handleToggleFlyout;return c.default.createElement("span",{className:"Pos(r) Fl(end) T(-6px)",onMouseEnter:a?e.openFlyout:null,onMouseLeave:a?e.closeFlyout:null},e.renderFlyout(),c.default.createElement(n(17).I13nButton,{className:"O(n) Bd(n) Px(6px) Py(2px)",onClick:s,i13nModel:(0,n(1268).getI13nModel)("options")},c.default.createElement(n(30).Icon,{name:"overflow",color:t,width:16,height:16})))}}},{key:"renderReportForm",value:function(){var e=this;if(!e.state.reportOpened)return null;var t=e.context,a=t.intl,s=a.formatMessage({id:"CANVASS_REPORT_REASON"}),o=a.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),r={outcm:"close"},i="desktop"===(0,f.default)(t,["session","dimensions","device"]),l=u.default.dedupe("D(n) P(6px) W(100%) H(33px) Fz(13px) Lh(12px) Mb(10px) Pstart(10px)",{"D(b)":e.state.selectedAbuseOption===o,"Fz(16px)":!i}),d="P(6px) W(30%) H(33px) Mend(10px) Mt(5px)";return c.default.createElement("div",{className:"Pos(a) End(35px) T(-3px) P(14px) Fz(13px) Lh(16px) C(#000) Z(1) Bgc(#fff) Bd Bdrs(3px) Bdc(#e0e4e9) Bxsh(boxShadow) report-form-container"},c.default.createElement("div",{className:"Mb(10px) Fw(b)"},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_REPORT_LABEL"})),c.default.createElement("div",{className:"Row"},e.renderFlagOption("CANVASS_FLAG_REASON_INAPPROPRIATE_POST",1),e.renderFlagOption("CANVASS_FLAG_REASON_DOES_NOT_BELONG_HERE",2),e.renderFlagOption("CANVASS_FLAG_REASON_SPAM",3),e.renderFlagOption("CANVASS_FLAG_REASON_COPYRIGHT_VIOLATION",4),e.renderFlagOption("CANVASS_FLAG_REASON_ELSE",5),c.default.createElement(v.default,{ref:"reportText",rows:5,tabIndex:"1",className:l,placeholder:s}),c.default.createElement(n(17).I13nButton,{type:"button",className:u.default.get("btn btn-secondary",d),onClick:e.handleAction.bind(e,"flag"),i13nModel:(0,n(1268).getI13nModel)("comment-report-cancel",r)},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_CANCEL"})),c.default.createElement(n(17).I13nButton,{type:"button",className:u.default.get("btn btn-primary",d),onClick:e.handleReport,i13nModel:(0,n(1268).getI13nModel)("comment-report-done",Object.assign({slk:e.state.selectedAbuseOption},r))},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_DONE"}))))}},{key:"render",value:function(){return c.default.createElement("div",{className:"action-form-container"},this.renderOverflowButton(),this.renderReportForm())}}]),t}(n(1).PureComponent);y.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object.isRequired,contextId:l.default.string,cpos:l.default.number,getStore:l.default.func.isRequired,guid:l.default.string,instanceId:l.default.string,intl:l.default.object.isRequired,isUserMessageHistory:l.default.bool,executeAction:l.default.func.isRequired,pos:l.default.number,session:l.default.object.isRequired,tags:l.default.string,userMessageHistoryGuid:l.default.string},t.default=(0,p.default)(y),e.exports=t.default},2590:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(26)),c=a(n(0)),u=a(n(1)),d=a(n(509)),f=n(3)("Canvass:components:ActivityIndicator"),p=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=e.userActivity;this.pendingMessage=!1,this.state={typingUsersCount:n&&n.get("typingUsersCount")||0}}return o(t,e),r(t,[{key:"componentDidMount",value:function(){this.openPipe()}},{key:"componentDidUpdate",value:function(e,t){0===t.typingUsersCount&&this.context.handleResize()}},{key:"componentWillUnmount",value:function(){this.closePipe()}},{key:"componentWillReceiveProps",value:function(e){this.pendingMessage=this.props.commenting!==e.commenting}},{key:"openPipe",value:function(){var e=this,t=e.context,a=t.componentConfig.pipe;if(a&&a.enabled){e.closePipe();var s=t.context,o=e.props.messageNamespace||t.namespace,r="/yahoo/canvass/"+o+"/"+s.replace(/-/g,"");n(1162).comet.config(a.cometConfig);var i=new(n(1162).Pipe)(r,{seqAlgo:"none",closeOnIdle:!0,maxIdle:a.maxPipeIdle});i.on("message",function(t){f("message",t),e.pendingMessage=!1,e.setState((0,l.default)(t,["data","data","data"],{}))}),i.on("error",function(t){f("error",t);var n=t&&t.code;n&&"close-failed"!==n&&"open-failed"!==n&&e.closePipe()}),i.on("idle",function(t){f("idle",t),e.closePipe()}),i.open(),e.pipe=i}}},{key:"closePipe",value:function(){this.pipe&&(this.pipe.close(),this.pipe=null,this.setState({typingUsersCount:0}))}},{key:"render",value:function(){var e=this.props,t=e.commenting,a=e.onClick,s=this.state.typingUsersCount;return s&&(t||!t&&this.pendingMessage)&&s--,s<=0?null:u.default.createElement(d.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:0,transitionEnterTimeout:0,transitionLeaveTimeout:300},u.default.createElement("div",{className:"Mt(24px) Mb(10px) H(0) BdT Bdc(#e0e4e9) Ta(c)"},u.default.createElement(n(17).I13nButton,{className:"Bgc(#f1f1f5) H(24px) Px(10px) Py(0) Pos(r) T(-14px) Bd Bdc(#e0e4e9) Bdrs(5px) Cur(p) O(n)",i13nModel:(0,n(1268).getI13nModel)("activity-indicator",{t3:s}),onClick:a},u.default.createElement("span",{className:"C(#26282a) Fz(12px) Fw(500) D(ib) Lh(20px) Va(tt)"},this.context.intl.formatMessage({id:"CANVASS_USERS_COMMENTING"},{count:s})),u.default.createElement("img",{className:"Va(m) Mstart(5px)",src:"https://s.yimg.com/dh/ap/default/161130/loading_dots.gif",width:"30",height:"10"}))))}}]),t}(n(1).PureComponent);p.contextTypes={componentConfig:c.default.object.isRequired,context:c.default.string.isRequired,handleResize:c.default.func.isRequired,intl:c.default.object.isRequired,namespace:c.default.string},t.default=p,e.exports=t.default},2591:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){var n=t.instanceId||t.id,a=e.getStore(_.default).getCommentsState(n),s=e.getStore(_.default).getTopCommentsState(n),o=e.getStore(_.default).getUserCommentsState(),r=e.getStore(P.default),i=e.getStore(A.default),l=e.getStore(I.default).getState(),c=e.getStore(k.default).getState(),u=a.get("deepLink"),d=e.getStore(N.default).getSentiments(n),f=(0,v.default)(t,["componentConfig","ui"],{}),p="",m=0,g="",y=a.get("messageList");return(t.context||(0,v.default)(e,["session","query","context"],""))===a.get("context")&&(p=a.get("context"),m=a.get("count"),g=a.get("contextDisplayText")),u&&u.get("replyId")&&(y=h.default.List([u.get("message")])),{commentingState:l.commenting,configStoreState:c,context:p,contextDisplayText:g,contextUrl:a.get("contextUrl"),count:m,deepLink:u?u.toJS():null,disabled:a.get("disabled"),endIndex:a.get("endIndex"),expanded:a.get("expanded",(0,v.default)(f,["expanded"],!0)),guid:r.getGUID(),messages:y,namespace:t.namespace||a.get("namespace")||c.namespace,newMessagesCount:a.get("newMessagesCount"),instanceId:n,recommendedTags:a.get("recommendedTags"),relatedTags:a.get("relatedTags"),selectedTags:a.get("selectedTags"),selectedTagsCount:a.get("selectedTagsCount"),sentiments:d,showLoadPrev:a.get("showLoadPrev"),sortBy:a.get("sortBy"),startIndex:a.get("startIndex"),tags:a.get("tags"),tagsAnd:a.get("tagsAnd"),tagsOr:a.get("tagsOr"),topComments:s&&f.smartTop?s:null,userActivity:a.get("userActivity"),userComments:o,userProfile:i.getProfile()}}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},u=a(n(0)),d=a(n(1)),f=a(n(494)),p=a(n(1805)),m=a(n(1335)),g=a(n(5)),h=a(n(6)),v=a(n(26)),y=a(n(106)),x=a(n(1159)),S=a(n(1580)),b=a(n(501)),C=a(n(1579)),T=a(n(2584)),E=a(n(2038)),O=a(n(2587)),M=a(n(486)),_=a(n(187)),I=a(n(1806)),k=a(n(189)),A=a(n(193)),N=a(n(2229)),P=a(n(60)),w=a(n(2590)),R=a(n(2039)),F=a(n(2223)),L=a(n(509)),B=a(n(2225)),j=a(n(2601)),U=a(n(2602)),D=a(n(2603)),H=function(e){function t(e){s(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,m.default)(this,["handleMessage","handleOverlay","handleRefresh","handleRemoveUserComments","handleResize","handleShowMessages","handleToggleComments","handleUserMessages"]),this.state={loadingPreviousComments:!1,scrolledPosition:"0px",overlay:!1},this.hasEnoughHeight=!0}return o(t,e),l(t,[{key:"getChildContext",value:function(){var e=this.props;return{componentConfig:e.componentConfig,configStoreState:e.configStoreState,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,guid:e.guid,instanceId:e.instanceId,namespace:e.namespace,tags:e.tags,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,handleUserMessages:this.handleUserMessages,handleOverlay:this.handleOverlay,handleResize:this.handleResize}}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"componentDidMount",value:function(){var e=this,t=e.context,a=e.props;if(e.setupPolling(a.configStoreState.pollingInterval),a.deepLink&&t.renderTarget.isActive()){var s=(0,n(10).findDOMNode)(e.refs.canvass),o=t.getStore("RouteStore").getCurrentRoute();if(s&&!(0,v.default)(o,["query","bcmt"],!1)){var r=a.componentConfig.FIXED_UH_HEIGHT||0,i=document.documentElement,l=i&&i.scrollTop||document.body.scrollTop||0;(0,f.default)(l+s.getBoundingClientRect().top-r)}}window.addEventListener("message",this.handleMessage),this.handleResize()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.handleMessage),this.setupPolling(0)}},{key:"componentDidUpdate",value:function(e,t){var n=this.props;e.expanded===n.expanded&&e.messages===n.messages||this.handleResize()}},{key:"getScrolledPosition",value:function(e){var t=0,a=e.userComments.get("guid"),s=(0,n(10).findDOMNode)(this.refs.canvass);if(!a||!s||!s.getBoundingClientRect)return t+"px";var o=s.getBoundingClientRect(),r=e.componentConfig.FIXED_UH_HEIGHT||0,i=Math.max(r,o.top),l=window.innerHeight-i;this.hasEnoughHeight=o.height>=400;var c=o.top<=0?Math.abs(o.top)+r:o.top<=r?r-o.top:0;if(l<400)t=c;else if(this.hasEnoughHeight){t=c+parseInt(l/2-200,10);var u=t+400;u>o.height&&(t=o.height-400-100)}else t=0;return t+5+"px"}},{key:"componentWillReceiveProps",value:function(e){var t=e.context,a=e.tags,s=e.count;if(!this.loadEventFired&&(a||t)){var o=this.context.i13n.getI13nNode().getMergedModel();o.cat=a||"",o.context=t,o.slk="canvass-load",o.t1="a3",o.t2="results",o.t3=s,(0,n(1268).fireRapidEvent)("secvw",o),this.loadEventFired=!0}this.setState({loadingPreviousComments:!1,scrolledPosition:this.getScrolledPosition(e)});var r=e.configStoreState.pollingInterval;this.props.configStoreState.pollingInterval!==r&&this.setupPolling(r)}},{key:"setupPolling",value:function(e){var t=this.timer;t&&(clearInterval(t),this.timer=null),e>0&&(this.timer=setInterval(this.handleRefresh,1e3*e))}},{key:"handleMessage",value:function(e){"canvass:expand"===e.data&&this.handleShowMessages("showExpanded")}},{key:"handleOverlay",value:function(e){this.setState({overlay:e})}},{key:"handleRefresh",value:function(){var e=this.props,t=e.deepLink,n=e.instanceId,a=e.namespace,s=e.selectedTags,o=e.sortBy;if(!("visible"!==(document&&document.visibilityState||"visible")||e.isReadOnly||!this.context.renderTarget.isActive()||t&&t.replyId)){var r=void 0;"createdAt"===o||"newest"===o?r=C.default:(0,v.default)(e,["componentConfig","ui","presence","readingUsersCount"])&&(r=T.default),r&&this.context.executeAction(r,{context:e.context,contextDisplayText:e.contextDisplayText,contextUrl:e.contextUrl,instanceId:n,namespace:a,refresh:!0,selectedTags:s&&s.size?s.join(","):"",sortBy:o,startIndex:e.startIndex,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}}},{key:"handleResize",value:function(){this.context.executeAction(O.default,{context:this.props.context})}},{key:"handleShowMessages",value:function(e){var t=this.props,n=t.selectedTags,a=b.default,s={context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,instanceId:t.instanceId,namespace:t.namespace,selectedTags:n&&n.size?n.join(","):"",sortBy:t.sortBy,tagsAnd:t.tagsAnd,tagsOr:t.tagsOr};"showPrev"===e?(this.setState({loadingPreviousComments:!0}),s.endIndex=t.endIndex,s.showPrevClicked=!0):"showNew"===e?s.showNewClicked=!0:"showExpanded"===e?(s.expanded=!0,a=x.default):"showCollapsed"===e&&(s.expanded=!1,a=x.default),this.context.executeAction(a,s)}},{key:"handleUserMessages",value:function(e,t,n){var a=this.props;this.context.executeAction(E.default,{guid:e,image:t,name:n,sortBy:(0,v.default)(a,["componentConfig","ui","sortTabs","defaultTab"]),instanceId:a.instanceId})}},{key:"handleRemoveUserComments",value:function(){this.handleOverlay(!1),this.context.getStore(_.default).resetUserComments()}},{key:"handleToggleComments",value:function(){this.handleShowMessages(this.props.expanded?"showCollapsed":"showExpanded")}},{key:"renderShowNewMessagesButton",value:function(){var e=this,t=this.props,a=t.newMessagesCount,s=this.state.loadingPreviousComments;if(a&&t.expanded)return d.default.createElement(n(17).I13nButton,{ref:"shownewbutton",i13nModel:(0,n(1268).getI13nModel)("comments-showNew"),onClick:function(){return e.handleShowMessages("showNew")},className:p.default.get("btn btn-secondary","D(b) Mx(a) Mt(25px) H(40px) Pos(r) Tt(c) Px(30px) Py(11px)")},!s&&a?"("+a+") ":"",d.default.createElement(n(28).FormattedMessage,{id:s?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_NEW_COMMENTS"}))}},{key:"renderShowPreviousButton",value:function(){var e=this,t=this.props;if(t.showLoadPrev&&t.expanded)return d.default.createElement(n(17).I13nButton,{ref:"showprevbutton",i13nModel:(0,n(1268).getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showPrev")},className:p.default.get("btn btn-secondary btn-spacing","showMore D(b) Mx(a) Pos(r) Tt(c)")},d.default.createElement(n(28).FormattedMessage,{id:this.state.loadingPreviousComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"}))}},{key:"renderActivityIndicator",value:function(){var e=this,t=this.props,n=(0,v.default)(t,["componentConfig","ui","presence","enabled"]);if(t.expanded&&n){var a=t.context,s=(0,v.default)(t,["commentingState",a],!1);return d.default.createElement(w.default,{key:a,commenting:s,onClick:function(){return e.handleShowMessages("showExpanded")},userActivity:t.userActivity})}}},{key:"renderTrendingTags",value:function(){var e=this.props,t=(0,v.default)(e,["componentConfig","ui","tags","trending"])||{};if(e.expanded&&e.count&&t.enabled)return d.default.createElement(j.default,i({hidden:e.selectedTags.size>0,tags:e.relatedTags},t))}},{key:"renderUserCount",value:function(){var e=this.props,t=e.userActivity;if((0,v.default)(e,["componentConfig","ui","presence","readingUsersCount"])&&e.count&&e.expanded&&t)return d.default.createElement(D.default,{count:t.get("readingUsersCount",0)})}},{key:"renderUserComments",value:function(){var e=this.props,t=e.userComments,n=e.instanceId;if(t.get("guid")&&t.get("instanceId")===n)return d.default.createElement(L.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:300,transitionEnterTimeout:300,transitionLeaveTimeout:300},d.default.createElement(U.default,{handleRemoveUserComments:this.handleRemoveUserComments,key:"userComments-"+t.get("guid"),parentScrolledPosition:this.state.scrolledPosition,ref:"userComments",userComments:t}))}},{key:"renderDisclaimer",value:function(e){if(e.enable){var t=e.text;return d.default.createElement("div",{className:"canvass-disclaimer Bd Bdc(#d8dade) P(10px) Mt(10px)"},d.default.createElement(n(30).Icon,{className:"Mend(6px) Fl(start)",color:"#ff0000",height:20,name:"attention",width:20}),(0,y.default)(t,function(e,t){return d.default.createElement("p",{className:"Mb(6px) Fz(14px) Fw(200)",dangerouslySetInnerHTML:{__html:e},key:t})}))}}},{key:"render",value:function(){var e=this.props,t=e.componentConfig,a=e.configStoreState,s=e.context,o=e.contextDisplayText,r=e.contextUrl,l=e.count,c=e.deepLink,u=e.recommendedTags,f=e.selectedTags,p=e.sortBy,m=e.topComments,h=t.isReadOnly,v=!(!c||!c.replyId);if(e.disabled||h&&0===l)return null;var y=e.messages?e.messages.toJS():[],x=t.ui||{},S=this.state.overlay?"StretchedBox Bgc(#fff) Op(0.7) Z(2)":"D(n)",b=void 0,C=void 0,T=void 0,E=void 0,O=void 0,M=void 0;if(l>0&&(e.expanded||c)){if(c&&c.message&&!v&&(E=d.default.createElement(R.default,{className:"Mstart(-12px) My(15px)",deepLink:c,isReadOnly:h,itemClassName:"P(12px)",list:[c.message],parentContextDisplayText:o,parentContextUrl:r,sortBy:p})),v)b=d.default.createElement(n(17).I13nButton,{className:"C(#188fff) Fz(16px) Fw(b) Mt(16px)",onClick:this.handleShowMessages.bind(this,"showExpanded")},d.default.createElement(n(30).Icon,{className:"Fl(start) Mstart(-15px) Mend(6px)",color:"#188fff",height:22,name:"caret-left",style:{strokeWidth:1},width:22}),d.default.createElement(n(28).FormattedMessage,{id:"CANVASS_VIEW_ALL_COMMENTS",values:{count:l}}));else if(!h&&y.length>0){var _=m&&m.get("messageList");_&&y.length>_.size&&"popular"!==p&&!c&&(C=d.default.createElement(R.default,{className:"Bd Bdc(#f1f1f5) Bgc(#fcfdff) Bdrs(4px) Mstart(-12px) Mb(24px)",isTopComments:!0,itemClassName:"Mt(5px) P(12px)",list:_.toJS(),parentContextDisplayText:o,parentContextUrl:r,sortBy:"popular"})),b=d.default.createElement(B.default,i({},x.sortTabs,{count:l,currentUserGuid:e.guid,currentUserProfile:e.userProfile,key:"sorting-tabs",ref:"sortingtabs",selectedTags:f,selectedTagsCount:e.selectedTagsCount,sortBy:p}))}T=d.default.createElement(R.default,{className:h?"Mstart(-8px)":"Mstart(-12px) Pt(5px)",isReadOnly:h,itemClassName:h?"Mt(10px) P(8px)":"Mt(5px) P(12px)",list:y,ref:"commentlist",parentContextDisplayText:o,parentContextUrl:r,sortBy:p})}s&&!h&&(O=this.renderShowNewMessagesButton(),M=this.renderShowPreviousButton());var I={cat:e.tags||"",cnv_bkt:a.rankingProfile||a.scoreAlgo,context:s,suggested_tags_count:u?u.size:0,tags:f.join(",")};return d.default.createElement(n(17).I13nDiv,{ref:"canvass",className:(0,g.default)(e.className,x.containerExtraClasses,{"Mt(20px) Mb(40px)":x.isFullScreen}),i13nModel:I},d.default.createElement("div",{className:S}),this.renderDisclaimer(x.disclaimer),this.renderUserComments(),v?void 0:d.default.createElement(F.default,{commentsExpanded:e.expanded,count:l,enableTitleClick:!x.expanded||x.enableCommentsToggle,isFullScreen:x.isFullScreen,isReadOnly:h,onTitleClick:this.handleToggleComments,ref:"commentform",relatedTags:e.relatedTags,selectedTags:e.selectedTags,sentiments:e.sentiments}),E,C,this.renderUserCount(),b,this.renderActivityIndicator(),O,this.renderTrendingTags(),T,M)}}]),t}(n(1).PureComponent);H.initializeAction=S.default,H.defaultProps={className:"tdv2-applet-canvass Lh(1.55em) M(a) smartphone_Px(10px) Pb(25px) Pos(r)",configStoreState:{},expanded:!0},H.componentConfig={name:"componentComments"},H.contextTypes={executeAction:u.default.func,getStore:u.default.func,i13n:u.default.object,renderTarget:u.default.object.isRequired,session:u.default.object},H.childContextTypes={componentConfig:u.default.object.isRequired,configStoreState:u.default.object.isRequired,context:u.default.string,contextDisplayText:u.default.string,contextUrl:u.default.string,guid:u.default.string,handleOverlay:u.default.func,handleResize:u.default.func,handleUserMessages:u.default.func,instanceId:u.default.string,namespace:u.default.string,session:u.default.object,tags:u.default.string,tagsAnd:u.default.string,tagsOr:u.default.string},t.default=(0,M.default)(H,[_.default,I.default,k.default,A.default,N.default,P.default],r,{session:u.default.object.isRequired}),e.exports=t.default},2593:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},c=a(n(0)),u=a(n(1)),d=a(n(1561)),f=a(n(2282)),p=a(n(283)),m=a(n(5)),g=a(n(2119)),h=a(n(26)),v=a(n(1335)),y=a(n(2589)),x=a(n(2222)),S=a(n(509)),b=a(n(73)),C=a(n(2224)),T=a(n(2596)),E=a(n(2598)),O=a(n(501)),M=(0,n(17).createI13nNode)("li"),_=(0,n(17).createI13nNode)("p",{bindClickEvent:!0}),I=5,k=/(?:\r\n|\r|\n)/g,A=function(e){function t(e,n){s(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,v.default)(this,["handleFeedbackMessage","handleImageLoad","handleMessageClick","handleViewTopClick"]);var a=n.guid,o=e.data.meta,r=void 0===o?{}:o,i=a&&a===(0,h.default)(r,["author","guid"])&&Date.now()/1e3-r.createdAt<=I;this.state={actionType:null,animClass:i?"Bgc(#fff8e4)":"",imageLoaded:!1,isNew:i,showFeedbackMessage:!1,visible:!1}}return o(t,e),i(t,[{key:"getChildContext",value:function(){var e=this.props;return{contextId:e.contextId,cpos:e.cpos,pos:e.pos}}},{key:"componentDidMount",value:function(){this.setState({animClass:""})}},{key:"componentWillUnmount",value:function(){clearTimeout(this._timer)}},{key:"getI13nModel",value:function(){var e=this.props,t=e.cpos,n=e.data,a=e.pos;return{msg_id:n.replyId||n.messageId,cpos:t,pos:null!==a?a:"",reply_lv:null!==a?1:0}}},{key:"renderContextInfo",value:function(){var e=this.context,t=this.props,a=(0,h.default)(t.data,["meta","contextInfo"])||{},s=a.displayText||"",o=a.url||"",r="context-info Mt(5px) Pb(8px) Fz(14px) C(#878c91) D(b) Td(n)";if((e.isUserMessageHistory||e.context!==t.contextId)&&null===t.pos&&s)return o?u.default.createElement(n(17).I13nAnchor,{className:r,href:o,i13nModel:(0,n(1268).getI13nModel)("context-link"),ref:"noopener noreferrer",target:"_blank"},u.default.createElement(n(28).FormattedMessage,{id:"CANVASS_POSTED_IN",values:{displayText:u.default.createElement("span",{className:"Fw(600) C(#188fff)"},s)}})):u.default.createElement("div",{className:r},u.default.createElement(n(28).FormattedMessage,{id:"CANVASS_POSTED_IN",values:{displayText:u.default.createElement("span",{className:"Fw(600) C(#26282a)"},s)}}))}},{key:"parseMessageForLinks",value:function(){var e=this.props,t=e.data,a=e.isReadOnly,s=t.tags,o=t.details.userText;if(o){var r=p.default.encode(o),i=r;!this.context.isUserMessageHistory&&(0,h.default)(this.context,["componentConfig","ui","tags","inline"])&&(i=(0,n(191).replaceTags)(i,s)),i=i.replace(k,"<br />");var l=new g.default(i,{newWindow:!0,className:"C(#188fff)"}).getText(),c=(0,m.default)("Wow(bw) C(#26282a) Mb(2px) Fz(15px) Lh(22px)",{"LineClamp(3,66px)":a});return i!==l?u.default.createElement(_,{className:c,dangerouslySetInnerHTML:{__html:l},i13nModel:(0,n(1268).getI13nModel)("link")}):u.default.createElement("div",{className:c,dangerouslySetInnerHTML:{__html:i}})}}},{key:"renderVideo",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],a=n.video,s=n.title,o=n.description;return u.default.createElement(C.default,{enhancedLink:{url:a?a.url:"",title:s,description:o,image:{url:a.coverImage?a.coverImage.url:""}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"handleImageLoad",value:function(){this.setState({imageLoaded:!0})}},{key:"renderImage",value:function(e){if(e&&0!==e.length){var t=(0,h.default)(e,[0,"image","resolutions"],[]),a=(0,h.default)(e,[0,"attribution","name"],"");a=a?(0,n(191).trimDescription)(a,30):"";var s={};if(t&&0!==t.length?(s=(0,f.default)(t,function(e){return e.width<=375}))||(s=t[0]):s=(0,h.default)(e,[0,"image"],{}),s){return u.default.createElement("div",{className:"Pos(r) D(ib) Lh(12px)"},u.default.createElement(b.default,{key:s.url,className:"W(a) Mah(320px) My(3px) H(a) Maw(100%)",url:s.url,onLoadCallback:this.handleImageLoad,forceLoad:!0,alt:"Image"+a,height:s.height,width:s.width}),(this.state.imageLoaded||this.context.isUserMessageHistory)&&a?u.default.createElement("div",{className:"W(100%) Ta(end) Op(0.6) Bg(gradient) Fz(9px) Fw(b) C(#e0e4e9) Pos(a) End(0) B(3px) Lh(8px) Py(4px)"},u.default.createElement("div",{className:"D(ib) Op(1)"},u.default.createElement(n(28).FormattedMessage,{id:"CANVASS_ATTRIBUTION",values:{author:a,source:u.default.createElement("img",{className:"W(a) Mend(5px) Mstart(2px) Va(bl)",src:"https://s.yimg.com/dh/ap/default/160620/tumblr-logo-transparent-1x.png"})}}))):void 0)}}}},{key:"renderSmartLink",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],a=n.url,s=n.title,o=n.description,r=n.coverImages;return u.default.createElement(C.default,{enhancedLink:{url:a,title:s,description:o,image:{url:r&&r[0].url}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"shouldEnableSeeMore",value:function(e,t){if(this.props.isReadOnly||!e.enable||!t)return!1;var n=t.userText||"";return n.length>e.maxTextLength||(n.match(k)||[]).length>=e.lines}},{key:"loadMessages",value:function(e){var t=this.context;t.executeAction(O.default,Object.assign({instanceId:t.instanceId,context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,tagsAnd:t.tagsAnd,tagsOr:t.tagsOr},e))}},{key:"handleViewTopClick",value:function(){this.loadMessages({selectedTags:"",sortBy:"popular"})}},{key:"handleMessageClick",value:function(e){var t=e.target.getAttribute("data-tag");if(t){this.loadMessages({selectedTags:t});var a=Object.assign(this.context.i13n.getI13nNode().getMergedModel(),this.getI13nModel(),{elm:"cmmt_tag",pos:1,slk:t});(0,n(1268).fireRapidClick)(a)}}},{key:"renderMessage",value:function(){var e=(0,h.default)(this,["props","data","details"],{}),t=this.props,n=t.seeMore,a=void 0===n?{}:n,s=t.isUserMessageHistory,o={enable:this.shouldEnableSeeMore(a,e),isUserMessageHistory:s,lines:a.lines,lineHeight:a.lineHeight};return u.default.createElement("div",{className:"message-content Wow(bw)",onClick:this.handleMessageClick},u.default.createElement(T.default,o,this.parseMessageForLinks()),this.renderVideo(e.videoMessageDetails)||this.renderSmartLink(e.linkMessageDetails)||this.renderImage(e.imageMessageDetails))}},{key:"renderTopCommentBanner",value:function(){if(this.props.isTopComments)return u.default.createElement(n(17).I13nButton,{className:"Pos(a) End(-2px) T(-5px) C(#fff) Bgc(#ffa700) Fz(10px) Fw(b) Px(20px) Py(0) Lh(20px) Bd(0)",i13nModel:(0,n(1268).getI13nModel)("sort",{elmt:"smarttop"}),onClick:this.handleViewTopClick},u.default.createElement("div",{className:"W(0) H(0) Pos(a) Start(0) Bd",style:{borderWidth:"10px 0 10px 5px",borderColor:"transparent transparent transparent #fcfdff"}}),u.default.createElement(n(30).Icon,{className:"Mend(5px)",color:"#fff",height:12,name:"star-filled",width:12,style:{verticalAlign:"text-top"}}),u.default.createElement(n(28).FormattedMessage,{id:"CANVASS_TOP_COMMENT"}))}},{key:"renderActionForm",value:function(){var e=this.context,t=this.props,n=t.data,a=n.meta.author;if(!t.isReadOnly&&!t.isTopComments)return u.default.createElement(y.default,{creator:a.guid,handleFeedbackMessage:this.handleFeedbackMessage,isReadOnly:t.isReadOnly,isUserMessageHistory:e.isUserMessageHistory,messageId:n.messageId,messageNamespace:t.messageNamespace,nickname:a.nickname,parentContextDisplayText:t.parentContextDisplayText,parentContextUrl:t.parentContextUrl,replyId:n.replyId})}},{key:"renderSocialControl",value:function(){var e=this.context,t=this.props,n=t.data,a=n.meta.author;if(!t.isReadOnly)return u.default.createElement(E.default,{author:a,className:"Pos(r)",instanceId:e.instanceId,isTopComments:t.isTopComments,isUserMessageHistory:e.isUserMessageHistory,key:"social-"+(n.replyId||n.messageId),messageId:n.messageId,messageNamespace:t.messageNamespace,parentContextDisplayText:t.parentContextDisplayText,parentTags:t.parentTags||[],reactionStats:n.reactionStats,replyCount:n.reactionStats.replyCount,replyId:n.replyId,sortBy:t.sortBy,userReportedAbuse:n.abuseReason,vote:(n.vote||"").toLowerCase()})}},{key:"handleFeedbackMessage",value:function(e){this.setFeedbackTimer(),this.setState({showFeedbackMessage:!0,actionType:e,visible:!0})}},{key:"setFeedbackTimer",value:function(){null!==this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){this.setState({visible:!1}),this._timer=null}.bind(this),2e3)}},{key:"renderFeedbackMessage",value:function(){if(this.state.visible){var e="delete"===this.state.actionType?"CANVASS_DELETED_MESSAGE":"flag"===this.state.actionType?"CANVASS_FLAGGED_MESSAGE":"CANVASS_MUTED_MESSAGE";return u.default.createElement("div",{className:"Pos(a) Start(0) Bxz(bb) W(100%) Bxsh(boxShadow) Py(6px) Px(8px) Fz(13px) C(#000) Bgc(#f1f1f5)"},u.default.createElement(n(30).Icon,{name:this.state.actionType,className:"Pstart(8px) Pend(8px) Va(m)!",color:"#000",width:21,height:21}),u.default.createElement(n(28).FormattedMessage,{id:e}))}}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.pos,s=this.state,o=s.isNew,i=s.showFeedbackMessage,l=t.messageId,c=t.replyId;if(!t.details)return null;var f=t.meta,p=f.createdAt,m=f.author,g=t.lastActivity&&t.lastActivity.activityAt||0,h=m&&m.image?m.image.url:"",v=this.getI13nModel(),y=d.default.dedupe("comment Pend(2px) "+e.className,this.state.animClass,{"Trsde(3s) Trsdu(.5s)":o&&!i,"Mb(40px)":i,"P(0)! M(0)!":i&&!this.state.visible}),b=d.default.dedupe("Pos(r) Pstart(52px)",{"Pstart(40px)":null!==a}),C=o?S.default:M,T=void 0;o&&(T={component:M,transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1});var E="comment"+(c||l);return i?u.default.createElement(S.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnterTimeout:500,transitionLeaveTimeout:1e3},u.default.createElement("li",{key:"feedback"+this.state.visible,className:y},this.renderFeedbackMessage())):u.default.createElement(C,r({key:E,className:y,i13nModel:v},T),u.default.createElement(n(17).I13nDiv,{isLeafNode:!0,i13nModel:(0,n(1268).getI13nModel)("comments-seen",{slk:v.msg_id})}),this.renderContextInfo(),u.default.createElement("div",{className:b},this.renderActionForm(),u.default.createElement(x.default,{activityAt:1e3*g,createdAt:1e3*p,creator:m.guid,imageUrl:h,isReadOnly:e.isReadOnly,key:"byline-"+(c||l),messageId:t.messageId,name:m.nickname,pos:a,replyCount:t.reactionStats.replyCount,replyId:t.replyId,sortBy:e.sortBy}),this.renderTopCommentBanner(),this.renderMessage(),this.renderSocialControl()))}}]),t}(n(1).PureComponent);A.contextTypes={componentConfig:c.default.object,configStoreState:c.default.object.isRequired,context:c.default.string,contextDisplayText:c.default.string,contextUrl:c.default.string,executeAction:c.default.func.isRequired,guid:c.default.string,i13n:c.default.object.isRequired,instanceId:c.default.string,intl:c.default.object,isUserMessageHistory:c.default.bool,session:c.default.object,tags:c.default.string,tagsAnd:c.default.string,tagsOr:c.default.string,userMessageHistoryGuid:c.default.string},A.childContextTypes={contextId:c.default.string,cpos:c.default.number,pos:c.default.number},A.defaultProps={className:"",contextId:null,cpos:null,data:{},pos:null,sortBy:""},t.default=A,e.exports=t.default},2594:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(5)),d=a(n(1146)),f=a(n(1525)),p=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={collapsed:!0,showToggle:!1},this.handleToggle=this.handleToggle.bind(this)}return o(t,e),r(t,[{key:"componentDidMount",value:function(){var e=(0,n(10).findDOMNode)(this.refs.tags);this.state.collapsed&&e&&e.offsetHeight<e.scrollHeight&&this.setState({showToggle:!0})}},{key:"handleClickTag",value:function(e){var t=this.props.handleClickTag;t&&t(e)}},{key:"renderTag",value:function(e,t){return c.default.createElement(n(17).I13nButton,{className:"Fz(12px) Fw(500) Lh(20px) C(#188fff) Bd(0) P(0) Mend(12px)",i13nModel:(0,n(1268).getI13nModel)("recommended-tags",{slk:e||"add_new"}),key:"tag-"+t,onClick:this.handleClickTag.bind(this,e),type:"button"},e?"#"+e:this.context.intl.formatMessage({id:"CANVASS_TAGS_ADD_NEW"}))}},{key:"handleToggle",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"renderToggle",value:function(){var e=this.state.collapsed;if(this.state.showToggle)return c.default.createElement(n(17).I13nButton,{className:"toggle C(#188fff) Bd(0) P(8px) Pos(a) End(4px) T(-2px)",i13nModel:(0,n(1268).getI13nModel)("recommended-tags",{elm:"cmmt_suggested_toggle"}),key:"more",onClick:this.handleToggle,ref:"more",title:this.context.intl.formatMessage({id:"CANVASS_TAGS_SHOW_"+(e?"MORE":"LESS")}),type:"button"},c.default.createElement(n(30).Icon,{asset:e?d.default:f.default,color:"#188fff",height:12,width:12}))}},{key:"render",value:function(){var e=this.props,t=this.state.collapsed,n=e.forReply,a=e.tags;return!a||a.size<e.minCount?null:c.default.createElement("div",{className:(0,u.default)("arrow_box_tags Bxsh(boxShadow) Pos(r) B(8px) Py(8px) Pstart(12px) Mt(20px)","Bd Bdc(#e0e4e9) Bdrs(4px) Bgc(#fff)",{"Mx(10px)":n,"Mx(16px)":!n})},c.default.createElement("div",{className:"Ov(h) Mend(16px)",ref:"tags",style:{maxHeight:t?20*e.minRows:20*e.maxRows}},c.default.createElement("span",{className:"Fz(12px) Fw(500) Mend(12px)"},this.context.intl.formatMessage({id:"CANVASS_TAGS_RECOMMENDED"})),this.renderTag("",-1),a.map(this.renderTag,this)),this.renderToggle())}}]),t}(n(1).PureComponent);p.contextTypes={intl:l.default.object.isRequired},p.defaultProps={minCount:1,minRows:2,maxRows:3},t.default=p,e.exports=t.default},2595:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1805)),d=a(n(1335)),f=a(n(513)),p=a(n(26)),m=a(n(6)),g=a(n(500)),h=a(n(501)),v=a(n(1156)),y=a(n(105)),x=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,d.default)(this,["handleNewSearch","handleRelatedTagsLoadEvent","handleRemoveRelatedTags","handleSelectTag"]),this.state={relatedTags:this.props.relatedTags,selectedTags:this.props.selectedTags}}return o(t,e),r(t,[{key:"handleRelatedTagsLoadEvent",value:function(){var e=this.context,t=this.state,a=t.relatedTags,s=t.selectedTags,o=this.getUpdatedRelatedTags(a,s,e.tagsAnd),r=e.i13n.getI13nNode().getMergedModel();r.cat=s&&s.size?s.join(","):"",r.elm="cmmt_side_convo",r.slk=o?o.size:0,(0,n(1268).fireRapidEvent)("secvw",r)}},{key:"componentWillReceiveProps",value:function(e){this.loadEventFired||(this.loadEventFired=!0,this.handleRelatedTagsLoadEvent()),this.setState({relatedTags:e.relatedTags,enableRelatedTags:e.enableRelatedTags})}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"handleRemoveRelatedTags",value:function(){this.props.handleRemoveRelatedTags()}},{key:"handleClickOutside",value:function(e){this.handleRemoveRelatedTags()}},{key:"handleNewSearch",value:function(){var e=this.context;e.executeAction(h.default,{instanceId:e.instanceId,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,selectedTags:this.state.selectedTags.join(",")}),this.handleRemoveRelatedTags(),(0,n(1268).fireRapidPageView)("trendingTags")}},{key:"removeSelectedTag",value:function(e){var t=(0,f.default)(this.state.selectedTags);if(t&&t.size){var n=t.filter(function(t){return e!==t});this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}}},{key:"handleGetNewRelatedTags",value:function(e){var t=this.context;t.executeAction(v.default,{context:t.context,tagsAnd:(0,n(191).joinFilterTags)(t.tagsAnd,e),tagsOr:t.tagsOr,instanceId:t.instanceId})}},{key:"handleSelectTag",value:function(e){var t=this.state.selectedTags?(0,f.default)(this.state.selectedTags):m.default.List(),n=t.push(e.get("tag"));this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}},{key:"renderSelectedTags",value:function(){var e=this.state.selectedTags;if(e&&e.size){var t={pos:e&&e.size||0,outcm:"remove"};return c.default.createElement("div",{className:"Mb(10px)"},e.map(function(e,a){var s="#"+e;return c.default.createElement(n(17).I13nButton,{key:e,className:"D(ib) Cur(p) Wob(ba) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px)",i13nModel:(0,n(1268).getI13nModel)("related-tags",Object.assign({slk:s,cpos:a},t)),onClick:this.removeSelectedTag.bind(this,e)},c.default.createElement("span",null,s),c.default.createElement("div",{className:"D(ib) Pos(r) Ta(c) T(2px) Mstart(8px) W(16px) H(16px) Bdc(t) Bdrs(50%) C(#878c91) Bgc(#188fff):h"},c.default.createElement(n(30).Icon,{asset:y.default,width:13,height:13,color:"#878c91",className:"Va(bl)! Fill(#ffffff)!:h Stk(#ffffff)!:h"})))},this))}}},{key:"getUpdatedRelatedTags",value:function(e,t,n){if(e&&e.size){var a=n?n.split(","):[],s=t&&t.size?t.join(",").split(","):[],o=a.concat(s);return e.filter(function(e){return-1===o.indexOf(e.get("tag"))})}}},{key:"renderTags",value:function(){var e=this.state,t=e.relatedTags,a=e.selectedTags,s=this.context.tagsAnd,o=this.getUpdatedRelatedTags(t,a,s),r=a&&a.size;if(!o||0===o.size)return c.default.createElement("div",{className:"Mt(4px) Fz(11px) C(#979ba7) Lh(14px)"},c.default.createElement(n(28).FormattedMessage,{id:r?"CANVASS_RELATED_TAGS_NO_MORE_TAGS_TO_FILTER_MESSAGE":"CANVASS_RELATED_TAGS_CURRENTELY_NO_TAGS_TO_FILTER_MESSAGE"}),c.default.createElement("span",null,"Â "),r?c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_RELATED_TAGS_APPLY_MESSAGE"}):void 0);var i={pos:t&&t.size||0,outcm:"select"};return c.default.createElement("div",{className:"Mt(6px) relatedTags"},o.map(function(e,t){var a="#"+e.get("tag");return c.default.createElement(n(17).I13nButton,{key:a,className:"D(ib) Wob(ba) Cur(p) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px) Bgc(#188fff):h C(#ffffff):h",i13nModel:(0,n(1268).getI13nModel)("related-tags",Object.assign({slk:a,cpos:t},i)),onClick:this.handleSelectTag.bind(this,e)},a)},this))}},{key:"renderHeading",value:function(){var e=this.context.tagsAnd;e=e?"#"+e.replace(/,/g,", #"):"";var t=this.state.selectedTags&&this.state.selectedTags.size;return c.default.createElement("div",{className:"Mb(8px) Fz(15px) Fw(b)"},e?e+" +":t?c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_SELECTED_TAGS"}):void 0,!t&&e?c.default.createElement("div",{className:"D(ib) W(65px) Mstart(5px) BdB Bdc(#bfbfc5) Bdbw(1px)"}):void 0)}},{key:"render",value:function(){var e="smartphone"===(0,p.default)(this.context,["session","dimensions","device"]),t=u.default.dedupe("related-tags ignore-react-onclickoutside W(260px) Pos(a) T(45px) Px(20px) Pt(15px) Pb(20px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc(#e0e4e9) Bxsh(boxShadowFlag)",{"Start(75px)":!e}),a=!(this.props.selectedTags&&this.props.selectedTags.size||this.state.selectedTags&&this.state.selectedTags.size),s=a?null:this.handleNewSearch,o=u.default.dedupe("Mt(16px) Fz(13px) M(0) Lh(n) H(35px) W(70px)",{"Cur(d)! C(#b9bdc5) Bgc(#e0e4e9) Bgc(#e0e4e9):h":a});return c.default.createElement("div",{className:t},c.default.createElement(n(17).I13nButton,{className:"related-tags-close-btn Pos(a) End(0) T(0) O(n)",i13nModel:(0,n(1268).getI13nModel)("related-tags",{slk:"cancel"}),onClick:this.handleRemoveRelatedTags.bind(this)},c.default.createElement(n(30).Icon,{asset:y.default,width:16,height:16,color:"#b9bdc5",className:"Fill(#000)!:h"})),this.renderHeading(),this.renderSelectedTags(),c.default.createElement("div",{className:"C(#26282a)"},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_RELATED_TAGS_FILTER_MESSAGE"})),this.renderTags(),c.default.createElement(n(17).I13nButton,{onClick:s,i13nModel:(0,n(1268).getI13nModel)("related-tags",{slk:"apply"}),className:u.default.get("btn btn-primary",o)},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_APPLY"})))}}]),t}(n(1).PureComponent);x.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,getStore:l.default.func,i13n:l.default.object,instanceId:l.default.string,session:l.default.object,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string},t.default=(0,g.default)(x),e.exports=t.default},2596:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1335)),d=a(n(1146)),f=a(n(1525)),p=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,u.default)(this,["getWrapperStyles","handleClick"]),this.state={expanded:!1}}return o(t,e),r(t,[{key:"handleClick",value:function(){this.setState({expanded:!this.state.expanded})}},{key:"getWrapperStyles",value:function(){return{maxHeight:this.state.expanded?null:this.props.lines*this.props.lineHeight,overflow:"hidden"}}},{key:"componentDidUpdate",value:function(e,t){t.expanded!==this.state.expanded&&this.context.handleResize()}},{key:"render",value:function(){var e=this.props,t=e.enable,a=e.children,s=this.state.expanded;if(!t)return a&&!Array.isArray(a)?a:c.default.createElement("div",null,a);var o=s?"CANVASS_SEE_LESS":"CANVASS_SEE_MORE",r=(0,n(1268).getI13nModel)("comment-seemore",{sec:e.isUserMessageHistory?"cmmt_his":"cmmts"});return c.default.createElement("div",{className:"canvass-see-more"},c.default.createElement("div",{className:"see-more-wrapper",style:this.getWrapperStyles()},a),c.default.createElement(n(17).I13nButton,{className:"more-button Fz(13px) Fw(b) Pt(3px) Pstart(0) Pb(6px) Bd(0) C(#26282a) O(n)",i13nModel:r,onClick:this.handleClick},c.default.createElement(n(28).FormattedMessage,{id:o,className:"more-button-label"}),c.default.createElement(n(30).Icon,{asset:s?f.default:d.default,className:"Px(5px) Va(m)!",color:"#26282a",width:9,height:9})))}}]),t}(n(1).Component);p.contextTypes={handleResize:l.default.func.isRequired},p.defaultProps={enable:!0,lines:3,lineHeight:22},t.default=p,e.exports=t.default},2597:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1335)),d=a(n(26)),f=a(n(105)),p=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,u.default)(this,["renderFlyout","handleToggleFlyout","handleCloseFlyout"]),this.state={flyoutOpened:!1}}return o(t,e),r(t,[{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened})}},{key:"handleCloseFlyout",value:function(){this.setState({flyoutOpened:!1})}},{key:"renderFlyout",value:function(e,t){if(this.state.flyoutOpened){var a="desktop"===t,s=this.context,o=s.contextId,r=s.tags,i=(0,n(1268).getI13nModel)("sentiments-close-tap",{context:o,cat:r}),l=void 0,u=e.POSITIVE,d=e.NEUTRAL,p=e.NEGATIVE;return l=u>=d&&u>=p?c.default.createElement(n(28).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_POSITIVE",values:{className:"C(#1ac567)"}}):d>=u&&d>=p?c.default.createElement(n(28).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_NEUTRAL",values:{className:"C(#ff7b12)"}}):c.default.createElement(n(28).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_NEGATIVE",values:{className:"C(#ff4d52)"}}),c.default.createElement("div",{className:"arrow_box Pos(a) End(0) W(150px) Whs(pl) Ta(c) Fw(500) T(28px) P(12px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc(#e0e4e9) Bxsh(boxShadowFlag)"},c.default.createElement(n(17).I13nButton,{i13nModel:i,onClick:this.handleCloseFlyout,className:"sentiments-close-btn Pos(a) End(0) P(0) Mend(2px) T(0) O(n)"},a?null:c.default.createElement(n(30).Icon,{asset:f.default,width:16,height:16,color:"#b9bdc5",className:"Fill(#000)!:h"})),l)}}},{key:"renderSentiment",value:function(e,t,n){return c.default.createElement("span",null,c.default.createElement("span",{className:"W(15px) H(15px) D(ib) Va(tt) Bgz(330%) Bg(sentimentsImg) "+n}),c.default.createElement("span",{className:"Pstart(3px) Fz(11px) Fw(b) "+t},e+"%"))}},{key:"render",value:function(){var e=this.context,t=this.props.sentiments,a=(0,d.default)(e.session,["dimensions","device"]),s="desktop"===a;if(!t||0===t.size)return null;var o={},r=0;if(t.forEach(function(e){var t=e.get("count");o[e.get("sentiment")]=t,r+=t}),r<=0)return null;o.POSITIVE=Math.round(o.POSITIVE/r*100)||0,o.NEUTRAL=Math.round(o.NEUTRAL/r*100)||0,o.NEGATIVE=100-o.POSITIVE-o.NEUTRAL,this.onMouseEnterLeave=s?this.handleToggleFlyout:null,this.click=s?null:this.handleToggleFlyout;var i=(0,n(1268).getI13nModel)("sentiments-tap",{context:e.contextId,cat:e.tags});return c.default.createElement(n(17).I13nDiv,{onClick:this.click,bindClickEvent:!0,i13nModel:i,onMouseEnter:this.onMouseEnterLeave,onMouseLeave:this.onMouseEnterLeave,className:this.props.className},this.renderFlyout(o,a),this.renderSentiment(o.POSITIVE,"C(#1ac567) Pend(6px)","Bgp(0)"),this.renderSentiment(o.NEUTRAL,"C(#ff7b12) Pend(6px)","Bgpx(50%)"),this.renderSentiment(o.NEGATIVE,"C(#ff4d52)","Bgpx(100%)"))}}]),t}(n(1).PureComponent);p.contextTypes={contextId:l.default.string,intl:l.default.object,session:l.default.object,tags:l.default.string},t.default=p,e.exports=t.default},2598:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){var n=e.getStore(b.default),a=e.getStore(x.default),s=n.getGUID(),o=t.messageId,r=t.instanceId,i=t.isTopComments,l=t.isUserMessageHistory,c=t.replyId,u=c?null:a.getCommentsState(r).get("deepLink"),d=[],f={};return c||(d=a.getReplyList(o,r,l,i).toJS(),f=a.getReplyListState(o,r,l,i).toJS()),{deepLink:u&&u.get("messageId")===o?u.toJS():void 0,guid:s,isAuthor:!(!t.author||!s)&&s===t.author.guid,isSignedIn:n.isSignedIn(),list:d,replyListState:f}}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},u=a(n(0)),d=a(n(1)),f=a(n(1335)),p=a(n(5)),m=a(n(26)),g=a(n(283)),h=a(n(501)),v=a(n(2583)),y=a(n(486)),x=a(n(187)),S=a(n(1806)),b=a(n(60)),C=a(n(2223)),T=a(n(2039)),E=a(n(2535)),O=a(n(2599)),M=a(n(2600)),_=function(e){function t(e){s(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,f.default)(this,["getReplies","handleCloseCommentForm","handleOpenReply","handleReplyClick","handleReplyFormBlur","handleToggleToolTip","handleViewTopClick"]),this.state={isReplyOpened:!(!e.deepLink||!e.deepLink.replyId),loadingNextComments:!1,loadingPreviousComments:!1,replyFormInFocus:!1}}return o(t,e),l(t,[{key:"getReplies",value:function(e){var t=this.context,a=this.props,s=a.replyListState.endIndex,o=!0,r=n(1389).SORT_LATEST;"previous"===e?this.setState({loadingPreviousComments:!0}):"next"===e?(r+="Desc",s=a.replyListState.nextIndex,this.setState({loadingNextComments:!0})):a.replyCount>0&&0===a.list.length?this.setState({loadingPreviousComments:!0}):o=!1,o&&t.executeAction(v.default,{context:t.contextId,count:10,index:s,instanceId:t.instanceId,isTopComments:a.isTopComments,isUserMessageHistory:t.isUserMessageHistory,messageId:a.messageId,namespace:a.messageNamespace,sortBy:r,tags:t.tags})}},{key:"handleOpenReply",value:function(e){this.getReplies(e),this.setState({isReplyOpened:!this.state.isReplyOpened,openedBy:e,replyFormInFocus:!1})}},{key:"handleCloseCommentForm",value:function(){this.props.replyId&&this.setState({isReplyOpened:!1,replyFormInFocus:!1})}},{key:"handleReplyClick",value:function(e){var t=this.props,n=t.messageId,a=t.replyId,s=this.state.openedBy!==e||!this.state.isReplyOpened,o=this.context.getStore(S.default),r=o.getActiveForm();s||r.messageId!==n||a||!r.replyId||(s=!0),s&&o.setActiveForm(t),this.getReplies(e),this.setState({isReplyOpened:s,openedBy:e,replyFormInFocus:s})}},{key:"handleReplyFormBlur",value:function(){this.state.isReplyOpened&&this.setState({replyFormInFocus:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showToolTip:!this.state.showToolTip})}},{key:"handleViewTopClick",value:function(){var e=this.context;e.executeAction(h.default,{instanceId:e.instanceId,context:e.contextId,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,selectedTags:"",sortBy:"popular",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}},{key:"renderReplyButton",value:function(){var e=this,t=this.props.replyCount,a=this.context.intl,s="show-reply-form O(n) P(0) Bd(n) Cur(p) Fz(12px) Fw(500) C(#878c91) D(ib) Mend(20px)";return d.default.createElement("div",{className:"comment-reply-controls D(ib)"},d.default.createElement(n(17).I13nButton,{className:(0,p.default)("reply-button",s),i13nModel:(0,n(1268).getI13nModel)("reply"),onClick:function(){return e.handleReplyClick("reply")}},d.default.createElement(n(30).Icon,{asset:E.default,color:"#878c91",height:15,className:"Mend(5px)"}),a.formatMessage({id:"CANVASS_REPLY"})),t>0?d.default.createElement(n(17).I13nButton,{className:(0,p.default)("replies-button",s),i13nModel:(0,n(1268).getI13nModel)(this.state.isReplyOpened?"replies-hide":"replies-show"),onClick:function(){return e.handleOpenReply("replies")}},a.formatMessage({id:"CANVASS_REPLIES"})+" ("+a.formatNumber(t)+")"):void 0)}},{key:"renderLoadingMessage",value:function(e){return d.default.createElement("div",{className:"loading-msg Fz(14px) Fw(b) Lh(n) C(#878c91) D(ib) "+e},this.context.intl.formatMessage({id:"CANVASS_LOADING_MORE_COMMENTS"}))}},{key:"renderShowPreviousButton",value:function(e){var t=this;return this.state.loadingPreviousComments?this.renderLoadingMessage(e):this.props.replyListState.showLoadPrev?d.default.createElement(n(17).I13nButton,{i13nModel:(0,n(1268).getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("previous")},className:"show-previous-button Fz(14px) Fw(b) C(#188fff) Bd(0) P(0) Mx(0) "+e},this.context.intl.formatMessage({id:"CANVASS_SHOW_PREVIOUS_COMMENTS"})):void 0}},{key:"renderShowNextButton",value:function(e){var t=this;return this.state.loadingNextComments?this.renderLoadingMessage(e):this.props.replyListState.nextIndex?d.default.createElement(n(17).I13nButton,{i13nModel:(0,n(1268).getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("next")},className:"show-next-button Fz(14px) Fw(b) C(#188fff) Bd(0) P(0) Mx(0) "+e},this.context.intl.formatMessage({id:"CANVASS_SHOW_MORE_REPLIES"})):void 0}},{key:"renderReplyBox",value:function(){if(this.state.isReplyOpened){var e=(0,m.default)(this.context,["componentConfig","ui","replySort"]),t=e===n(1389).SORT_LATEST,a=(0,p.default)({"My(10px)":t,"Mt(20px) Mb(2px)":!t});return t?d.default.createElement("div",{className:"reply-box"},this.renderCommentForm(e),this.renderShowNextButton(a),this.renderCommentList(e),this.renderShowPreviousButton(a+" Mstart(40px)")):d.default.createElement("div",{className:"reply-box"},this.renderShowPreviousButton(a),this.renderCommentList(e),this.renderShowNextButton(a+" Mstart(40px)"),this.renderCommentForm(e))}}},{key:"renderCommentForm",value:function(e){var t=this.props,n=t.author,a=void 0===n?{}:n,s=t.deepLink,o=t.replyId,r=a.nickname;return d.default.createElement(C.default,{cpos:this.context.cpos,deepLink:s,forReply:!0,handleCloseCommentForm:this.handleCloseCommentForm,handleReplyFormBlur:this.handleReplyFormBlur,mentions:o&&r?[{guid:a.guid,nickname:r}]:null,messageId:t.messageId,messageNamespace:t.messageNamespace||null,parentContextDisplayText:t.parentContextDisplayText,parentTags:t.parentTags||[],replyFormInFocus:this.state.replyFormInFocus,replyId:o,replySort:e,value:o&&r?g.default.decode("@"+r+" "):""})}},{key:"renderCommentList",value:function(e){var t=this.props,a="Mstart(-10px) Pt(10px)",s=[].concat(t.list);return e===n(1389).SORT_LATEST&&(a="Mstart(-10px)",s.reverse()),d.default.createElement(T.default,{className:a,cpos:this.context.cpos,deepLink:t.deepLink,itemClassName:"Py(10px) Pstart(10px)",key:"commentlist3",list:s})}},{key:"getThumbProps",value:function(e){var t=this.context,a=this.props,s={contextId:t.contextId,isSignedIn:a.isSignedIn,key:e,messageId:a.messageId,messageNamespace:a.messageNamespace,onToggleToolTip:this.handleToggleToolTip,reactionStats:a.reactionStats,replyId:a.replyId,thumbName:e,vote:a.vote,voteType:e},o=e&&n(1389).THUMB_PROPS[e];return o&&(s=Object.assign({selectedColor:o.color,selectedIcon:o.icon},s,o),delete s.color),s}},{key:"renderThumbs",value:function(){var e=this,t=(0,m.default)(e.context,["componentConfig","ui","thumbs"],["up"]),n=t.length;return d.default.createElement("div",{className:"ratings D(ib) Pos(r)"},t.map(function(t,a){var s=(0,p.default)("O(n) Bgc(t) Bdc(t) M(0) P(0) Bd(n)",{"Mend(12px)":a<n-1});return d.default.createElement(O.default,i({},e.getThumbProps(t),{className:s,showCount:n>1}))}),d.default.createElement(M.default,{enable:e.state.showToolTip,handleToggleToolTip:e.handleToggleToolTip}))}},{key:"renderTopCommentButton",value:function(){if(this.props.isTopComments)return d.default.createElement(n(17).I13nButton,{className:"Fl(end) C(#188fff) Fw(b) Fz(12px) Fl(end) P(0) Mend(12px)",i13nModel:(0,n(1268).getI13nModel)("sort",{elmt:"smarttop"}),onClick:this.handleViewTopClick},this.context.intl.formatMessage({id:"CANVASS_VIEW_MORE"}))}},{key:"componentDidUpdate",value:function(e,t){(e.list||[]).length===(this.props.list||[]).length&&t.isReplyOpened===this.state.isReplyOpened||this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=this.state,a={isReplyOpened:n.isReplyOpened||!(!e.deepLink||!e.deepLink.replyId)};e.messageId!==t.messageId||e.replyId!==t.replyId||e.sortBy!==t.sortBy||!e.deepLink&&t.deepLink?a={isReplyOpened:!1,loadingNextComments:!1,loadingPreviousComments:!1,replyFormInFocus:!1}:(n.loadingPreviousComments&&e.replyListState.endIndex!==t.replyListState.endIndex&&(a.loadingPreviousComments=!1),n.loadingNextComments&&e.replyListState.nextIndex!==t.replyListState.nextIndex&&(a.loadingNextComments=!1)),this.setState(a)}},{key:"render",value:function(){var e=this.props,t=!e.replyId||(0,m.default)(this.context,["componentConfig","ui","inlineReplies"],!1);return d.default.createElement("div",{className:(0,p.default)("social-control",e.className)},d.default.createElement("div",{className:"social-control-bar Pt(5px)"},t?this.renderReplyButton():void 0,this.renderThumbs(),this.renderTopCommentButton()),t?this.renderReplyBox():void 0)}}]),t}(n(1).PureComponent);_.contextTypes={componentConfig:u.default.object,configStoreState:u.default.object.isRequired,contextId:u.default.string,contextUrl:u.default.string,contextDisplayText:u.default.string,cpos:u.default.number,executeAction:u.default.func.isRequired,getStore:u.default.func.isRequired,handleResize:u.default.func.isRequired,instanceId:u.default.string,intl:u.default.object,isUserMessageHistory:u.default.bool,oauthConsumerKey:u.default.string,oauthConsumerSecret:u.default.string,pos:u.default.number,tags:u.default.string,userMessageHistoryGuid:u.default.string},_.defaultProps={list:[],replyListState:{}},t.default=(0,y.default)(_,[b.default,x.default],r),e.exports=t.default},2599:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1335)),d=a(n(214)),f=a(n(2221)),p=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,u.default)(this,["onMouseEnter","onMouseLeave"]),this.state={hover:!1}}return o(t,e),r(t,[{key:"onMouseEnter",value:function(){this.setState({hover:!0})}},{key:"onMouseLeave",value:function(){this.setState({hover:!1})}},{key:"handleRating",value:function(e){var t=this.context,n=this.props;t.executeAction(f.default,{context:n.contextId,isUserMessageHistory:t.isUserMessageHistory||null,instanceId:t.instanceId,messageId:n.messageId,namespace:n.messageNamespace,voteType:e===n.voteType?"clear":n.voteType,replyId:n.replyId,pos:"number"==typeof t.pos?t.pos:null})}},{key:"bindHandleRating",value:function(e){var t={trailing:!1};this.handleVote=(0,d.default)(this.handleRating.bind(this,e.vote),1500,t)}},{key:"componentWillMount",value:function(){this.bindHandleRating(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.bindHandleRating(e)}},{key:"render",value:function(){var e=this.props,t=e.vote,a=e.voteType,s=e.thumbName,o=e.size,r=this.context.intl,i=this.handleVote,l=void 0,u=void 0,d=void 0;l=this.state.hover||t===a?e.selectedColor:e.color,d=t===a?e.selectedIcon:e.icon,u=(0,n(1268).getI13nModel)("vote",{rcv_msg_id:e.replyId||e.messageId,slk:t===a?"undo vote "+s:"vote "+s});var f=(e.replyId||e.messageId)+d,p=e.reactionStats[a+"VoteCount"]||0,m=r.formatNumber(p),g=r.formatMessage({id:"CANVASS_REACTION_"+s.toUpperCase()});return e.isSignedIn||(i=e.onToggleToolTip),c.default.createElement(n(17).I13nButton,{title:e.showLabel?void 0:g,className:"thumb-"+a+" "+e.className,onClick:i,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,i13nModel:u},c.default.createElement(n(30).Icon,{key:f,name:d,className:"D(ib) Va(m)!",color:l,width:o,height:o}),p>0||e.showCount?c.default.createElement("span",{className:"rating-count D(ib) Mstart(4px) Va(m) Fz(12px) C(#878c91)"},m):void 0,e.showLabel?c.default.createElement("label",{className:"rating-label D(b) Fz(11px) Mt(2px) Cur(p)"},g):void 0)}}]),t}(n(1).PureComponent);p.contextTypes={configStoreState:l.default.object.isRequired,executeAction:l.default.func.isRequired,instanceId:l.default.string,intl:l.default.object,isUserMessageHistory:l.default.bool,pos:l.default.number},p.defaultProps={className:"O(n) Bgc(t) Bdc(t) M(0) P(0) Bd(n)",color:"#878c91",icon:"favorite",reactionStats:{},selectedColor:"#ef152e",selectedIcon:"heart",showLabel:!1,size:16,thumbName:"up",voteType:"up"},t.default=p,e.exports=t.default},2600:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(500)),d=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={isTooltipOpened:this.props.enable}}return o(t,e),r(t,[{key:"handleClickOutside",value:function(e){this.props.enable&&(this.setState({isTooltipOpened:!1}),this.props.handleToggleToolTip())}},{key:"componentWillReceiveProps",value:function(e){this.setState({isTooltipOpened:e.enable})}},{key:"render",value:function(){if(!this.state.isTooltipOpened)return null;var e=(0,n(1690).getLoginUrl)(this.context);return c.default.createElement("div",{tabIndex:"-1",className:"ignore-react-onclickoutside tooltip Bgc(#fff) Bd Bdrs(3px) Bdc(#d8dade) Pos(a) Z(1)"},c.default.createElement("div",{className:"Pos(r) M(0) P(10px) W(90px)"},c.default.createElement(n(17).I13nAnchor,{href:e,rel:"noopener noreferrer",target:"_top",className:"tooltip-signin C($fg-link)",i13nModel:(0,n(1268).getI13nModel)("login",{tar:e,context:this.context.context,cat:this.context.tags})},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_PLEASE_SIGN_IN"}))))}}]),t}(n(1).PureComponent);d.contextTypes={context:l.default.string,contextUrl:l.default.string,getStore:l.default.func,session:l.default.object,tags:l.default.string},d.defaultProps={enable:!1},t.default=(0,u.default)(d),e.exports=t.default},2601:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=(a(n(5)),a(n(26)),a(n(501))),d=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={collapsed:!0,showToggle:!1},this.handleToggle=this.handleToggle.bind(this)}return o(t,e),r(t,[{key:"componentDidMount",value:function(){var e=(0,n(10).findDOMNode)(this.refs.tags);this.state.collapsed&&e&&e.offsetHeight<e.scrollHeight&&this.setState({showToggle:!0})}},{key:"handleSelectTag",value:function(e){var t=this.context;t.executeAction(u.default,{instanceId:t.instanceId,context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,tagsAnd:t.tagsAnd,tagsOr:t.tagsOr,selectedTags:e.get("tag")})}},{key:"renderTag",value:function(e,t){var a=e.get("tag");return c.default.createElement(n(17).I13nButton,{className:"Fz(14px) Fw(500) Lh(1) P(8px) Bd Bdc(#e0e4e9) Bdrs(4px) Mend(8px) Mt(8px) C(#188fff) Bdc(#188fff):h",i13nModel:(0,n(1268).getI13nModel)("related-tags",{selected_tag:a,slk:a,cpos:t,pos:1}),key:"tag-"+t,onClick:this.handleSelectTag.bind(this,e)},"#"+a,c.default.createElement("span",{className:"Fz(12px) Fw(n) Mstart(4px) C(#74797e)"},"("+this.context.intl.formatNumber(e.get("count"))+")"))}},{key:"handleToggle",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"renderToggle",value:function(){var e=this.state.collapsed;if(this.state.showToggle)return c.default.createElement(n(17).I13nButton,{className:"toggle Fz(12px) Fw(b) Lh(1) C(#188fff) P(0) B(0) Mstart(8px)",i13nModel:(0,n(1268).getI13nModel)("related-tags",{elm:"cmmt_trending_toggle"}),onClick:this.handleToggle},this.context.intl.formatMessage({id:"CANVASS_TAGS_SHOW_"+(e?"MORE":"LESS")}))}},{key:"render",value:function(){var e=this.props,t=e.tags,a=this.state.collapsed;return e.hidden||!t||t.size<e.minCount?null:c.default.createElement("div",{className:e.className},c.default.createElement("span",{className:"D(ib) Bdrs(48%) Bgc(#5601ec) Fl(start) W(40px) H(40px)"},c.default.createElement(n(30).Icon,{className:"Cur(d) Mx(a) D(b) Pos(r) T(6px)",color:"#fff",height:24,name:"trending",width:24})),c.default.createElement("div",{className:"Pstart(12px) Ov(h)"},c.default.createElement("div",{className:"Fz(14px) Fw(500)"},this.context.intl.formatMessage({id:"CANVASS_TAGS_TRENDING"}),this.renderToggle()),c.default.createElement("div",{className:"Ov(h)",ref:"tags",style:{maxHeight:a?40*e.minRows:40*e.maxRows}},t.map(this.renderTag,this))))}}]),t}(n(1).PureComponent);d.defaultProps={className:"Mt(20px) Mb(10px)",minCount:3,minRows:1,maxRows:3},d.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,i13n:l.default.object,instanceId:l.default.string,intl:l.default.object.isRequired,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string},t.default=d,e.exports=t.default},2602:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1805)),d=a(n(1335)),f=a(n(26)),p=a(n(500)),m=a(n(2038)),g=a(n(105)),h=a(n(2039)),v=a(n(2225)),y=a(n(2604)),x=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,d.default)(this,["handleLoadEvent","handleShowMessages","onScrollHandler"]),this.state={commentsLoading:!1,loadingPreviousComments:!1}}return o(t,e),r(t,[{key:"getChildContext",value:function(){return{isUserMessageHistory:!0,userMessageHistoryGuid:this.props.userComments.get("guid")}}},{key:"handleClickOutside",value:function(e){this.props.handleRemoveUserComments&&this.props.handleRemoveUserComments()}},{key:"handleLoadEvent",value:function(){var e=this.context.i13n.getI13nNode().getMergedModel();e.slk="canvass-load",(0,n(1268).fireRapidEvent)("secvw",e)}},{key:"onScrollHandler",value:function(e){var t=this.scrollingElement,n=t.scrollTop,a=t.scrollHeight,s=t.clientHeight,o=e.deltaY,r=o>0;return r&&o>a-s-n?(t.scrollTop=a,this.cancelScrollEvent(e)):!r&&-o>n?(t.scrollTop=0,this.cancelScrollEvent(e)):void 0}},{key:"cancelScrollEvent",value:function(e){return e.stopImmediatePropagation(),e.preventDefault(),e.returnValue=!1,!1}},{key:"componentDidMount",value:function(){this.context.handleOverlay(!0);var e=(0,n(10).findDOMNode)(this.refs.usercomments);e.style.top=this.props.parentScrolledPosition,this.scrollingElement=e,this.scrollingElement.addEventListener("wheel",this.onScrollHandler,!1),this.handleLoadEvent(),(0,n(1268).fireRapidPageView)("userHistory")}},{key:"componentWillUnmount",value:function(){this.scrollingElement.removeEventListener("wheel",this.onScrollHandler,!1)}},{key:"componentWillReceiveProps",value:function(e){this.setState({commentsLoading:!1,loadingPreviousComments:!1})}},{key:"componentDidUpdate",value:function(e,t){e.userComments.get("guid")!==this.props.userComments.get("guid")&&(this.scrollingElement.style.top=this.props.parentScrolledPosition,this.handleLoadEvent())}},{key:"handleShowMessages",value:function(e){var t=this.props.userComments,n={guid:t.get("guid"),image:t.get("image"),name:t.get("name"),sortBy:t.get("sortBy"),instanceId:this.context.instanceId};"showPrev"===e&&(this.setState({loadingPreviousComments:!0}),n.endIndex=t.get("endIndex"),n.showPrevClicked=!0),this.context.executeAction(m.default,n)}},{key:"renderShowPreviousButton",value:function(){var e=this;return this.props.userComments.get("showLoadPrev")?c.default.createElement(n(17).I13nButton,{i13nModel:(0,n(1268).getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showPrev")},className:u.default.get("btn btn-secondary btn-spacing","showMore D(b) Mx(a) Pos(r) Tt(c)")},c.default.createElement(n(28).FormattedMessage,{id:this.state.loadingPreviousComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"})):null}},{key:"render",value:function(){var e=this.context,t=this.props,a=t.userComments,s=a.get("messageList"),o=a.get("count"),r=a.get("guid"),i=a.get("image"),l=a.get("name"),d=a.get("sortBy"),p=s&&s.size?s.toJS():[],m="smartphone"===(0,f.default)(e,["session","dimensions","device"]),x=u.default.dedupe("user-comments ignore-react-onclickoutside Pos(a) Ovx(s) Ovs(touch) Bxz(bb) W(70%) Mstart(-35%) W(90%)--xxs Mstart(-45%)--xxs H(400px) Start(50%) Bgc(#fff) Z(9) Bd Bdrs(3px) Bdc(#e0e4e9) Bxsh(boxShadowFlag) ",{"W(90%) Mstart(-45%)":m,"H(210px)":!o}),S={sec:"cmmt_his",context:r};return c.default.createElement(n(17).I13nDiv,{className:x,i13nModel:S,ref:"usercomments"},c.default.createElement(n(17).I13nButton,{className:"user-comments-close-btn O(n) Pos(a) Z(1) M(10px) P(0) End(0) T(0)",i13nModel:(0,n(1268).getI13nModel)("user-close-tap"),onClick:t.handleRemoveUserComments},c.default.createElement(n(30).Icon,{asset:g.default,width:21,height:21,color:"#fff",className:"close-icon Cur(p)"})),c.default.createElement(y.default,{className:"user-info",key:"userinfo",creator:r,name:l,imageUrl:i,count:o,isUserMessageHistory:!0}),o>0?c.default.createElement("div",{className:"Px(20px) Pt(10px)"},c.default.createElement(v.default,{arrangement:(0,f.default)(e.componentConfig,["ui","sortTabs","arrangement"]),key:"usercomments-sorting-tabs",count:o,userMessageHistoryName:l,userMessageHistoryImage:i,sortBy:d}),c.default.createElement(h.default,{list:p,sortBy:d,itemClassName:"Py(12px)",commentsLoading:this.state.commentsLoading}),this.renderShowPreviousButton()):null)}}]),t}(n(1).PureComponent);x.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,handleOverlay:l.default.func,i13n:l.default.object,instanceId:l.default.string,session:l.default.object},x.childContextTypes={isUserMessageHistory:l.default.bool,userMessageHistoryGuid:l.default.string},t.default=(0,p.default)(x),e.exports=t.default},2603:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=(a(n(0)),a(n(1))),c=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={updating:!1}}return o(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.count!==e.count})}},{key:"componentDidUpdate",value:function(){var e=this;e.state.updating&&setTimeout(function(){e.setState({updating:!1})},500)}},{key:"render",value:function(){var e=this.props.count,t=this.state.updating;return e?l.default.createElement("div",{className:"Fl(end) Mt(2px) Fz(14px) Fw(500) Trsdu(.5s) "+(t?"C(#5601ec)":"C(#878c91)")},l.default.createElement(n(30).Icon,{className:"Mend(6px)",color:"#5601ec",height:18,name:"groups-fill",style:{verticalAlign:"text-bottom"},width:18}),l.default.createElement(n(28).FormattedMessage,{id:"CANVASS_USERS_VIEWING",values:{count:e}})):null}}]),t}(n(1).PureComponent);t.default=c,e.exports=t.default},2604:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1165)),d=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return o(t,e),r(t,[{key:"renderCommentsCount",value:function(){var e=this.props.count,t=this.context.intl,a=void 0;return a=1===e?"1 "+t.formatMessage({id:"CANVASS_COMMENT"}):t.formatNumber(e)+" "+t.formatMessage({id:"CANVASS_COMMENTS"}),c.default.createElement("div",{className:"user-comments-count Ta(c) Pt(10px) Pb(20px) Fz(12px) Fw(600) C(#fff)"},c.default.createElement(n(30).Icon,{className:"comment-icon Cur(d)! Va(m)! Mend(5px) W(21px) H(21px)",name:"comments",color:"#fff"}),a)}},{key:"renderAvatar",value:function(e){var t=this.context,a=this.props,s=a.imageUrl,o="Bdrs(48%) Bd Bdc(#fff) Bdw(2px) avatar D(b)! Mx(a) W(80px) Pos(r)";if(a.creator===t.guid){var r=t.session.dimensions,i="https://login.yahoo.com/account/personalinfo/?.intl="+r.intl+"&.lang="+r.lang;return c.default.createElement(n(17).I13nAnchor,{className:o,href:i,target:"_blank",title:t.intl.formatMessage({id:"CANVASS_EDIT_PROFILE"})},c.default.createElement(u.default,{src:s,name:e,enableAlphatar:!0,size:80}),c.default.createElement("div",{className:"StretchedBox Bg(gradient) Bdrs(48%) Op(0.7)"}),c.default.createElement(n(30).Icon,{className:"Pos(a) B(6px) Start(28px)",color:"#fff",name:"camera",height:22,width:22}))}return c.default.createElement(u.default,{src:s,name:e,enableAlphatar:!0,size:80,className:o})}},{key:"getUserProfile",value:function(){var e=this.props.name||this.context.intl.formatMessage({id:"CANVASS_ANONYMOUS"});return c.default.createElement("div",{key:e,className:"user-profile D(b) Mx(a) Pos(r) Z(1)"},this.renderAvatar(e),c.default.createElement("div",{className:"username Ta(c) Mt(10px) Fw(600) Fz(16px) C(#fff)"},e),this.renderCommentsCount())}},{key:"render",value:function(){return c.default.createElement("div",{className:"user-info Fz(13px) Pt(44px) Pos(r) Ov(h)"},c.default.createElement("div",{className:"user-info-bg StretchedBox Bgz(cv) Bgr(nr) Bgpy(20%) Blur(15px)",style:{backgroundImage:"url("+this.props.imageUrl+")"}}),c.default.createElement("div",{className:"StretchedBox Bgc(#000) Op(0.7)"}),this.getUserProfile())}}]),t}(n(1).PureComponent);d.contextTypes={guid:l.default.string,intl:l.default.object,session:l.default.object},t.default=d,e.exports=t.default},2605:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},l=a(n(0)),c=a(n(1)),u=a(n(1335)),d=a(n(287)),f=a(n(2282)),p=(0,n(17).createI13nNode)("div",{bindClickEvent:!0}),m=300,g=function(e){function t(e){s(this,t),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),(0,u.default)(this,["handlePostSticker"]),this.onScroll=(0,d.default)(this.onScroll.bind(this),m)}return o(t,e),r(t,[{key:"componentDidMount",value:function(){this.paginating=!1}},{key:"componentDidUpdate",value:function(){this.paginating&&this.scrollContainer&&!this.props.isLoading&&setTimeout(function(){this.scrollContainer.scrollLeft+=50,this.paginating=!1}.bind(this),0)}},{key:"handlePostSticker",value:function(e,t){this.props.onStickerClick&&this.props.onStickerClick(e,t)}},{key:"onScroll",value:function(){if((this.scrollContainer=this.refs.sticker)&&this.scrollContainer.getBoundingClientRect){var e=this.scrollContainer.getBoundingClientRect();this.props.offset&&!this.props.error&&e&&this.scrollContainer.scrollLeft+e.width+200>=this.scrollContainer.scrollWidth&&(this.paginating=!0,this.props.handleSearch())}}},{key:"renderErrorBox",value:function(){var e=this.props.stickers;return!this.props.error||e&&e.length?null:c.default.createElement("div",{className:"stickers-error-box H(100%) Bg(#fff) Ta(c) C(#878c91) Pos(a) W(100%) Z(1)"},c.default.createElement("span",{className:"Pos(r) T(45%)"},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_NO_GIFS_FOUND"})))}},{key:"renderLoadingBox",value:function(){return this.props.isLoading?c.default.createElement("div",{className:"stickers-loading-box H(100%) Bg(bgLoading) Op(0.5) Ta(c) C(#878c91) Pos(a) W(100%) Z(1)"}):null}},{key:"renderStickersList",value:function(){var e=this.props.stickers;if(!e||!e.length)return null;return c.default.createElement("div",{className:"Pos(r) D(b) Bgc(#fff) Maw(100%)!"},c.default.createElement("div",{className:"Row Pos(r)"},c.default.createElement("div",{ref:"sticker",className:"stickers-list H(100%) Ovx(s) Ovy(h) Whs(nw) W(100%) Ovs(touch)",onScroll:this.onScroll},e.map(this.renderItem,this))))}},{key:"renderItem",value:function(e,t){var a=this.context,s=this.props,o=s.authors,r=s.overlayClasses,i=s.overlayLabelClasses,l=(0,f.default)(e,function(e){return e.height>=145});l||(l=e[e.length-1]);var u=l,d=u.url,m=(0,n(1268).getI13nModel)("tumblr-post",{slk:"gif-"+d,context:a.context,cat:a.tags});return c.default.createElement(p,{i13nModel:m,key:d,onClick:this.handlePostSticker.bind(this,e,o.get(t)),className:"D(ib) Pos(r) Mend(4px) sticker-item"},c.default.createElement("img",{className:"Cur(p)",height:145,width:Math.round(145/l.height*l.width),src:d}),c.default.createElement("div",{className:r},c.default.createElement("p",{className:i},c.default.createElement(n(28).FormattedMessage,{id:"CANVASS_POST"}))))}},{key:"render",value:function(){return c.default.createElement("div",{className:"H(100%) Va(t) Pstart(16px) Pos(r) Maw(100%)! stickers"},this.renderLoadingBox()||this.renderErrorBox(),this.renderStickersList())}}]),t}(n(1).PureComponent);t.Stickers=g,g.contextTypes={context:l.default.string,tags:l.default.string},g.defaultProps={overlayClasses:"sticker-overlay W(100%) H(100%) Pos(a) T(0) Start(0) Bg(overlaySticker):h Op(0) Op(1):h Trsdu(.42s) Cur(p)",overlayLabelClasses:"post-label Pos(r) Ta(c) Fw(600) Fz(14px) W(54px) H(20px) T(50%) Start(50%) Translate(-50%,-50%) P(6px) C(#fff) Bgc(#222) Bdrs(2px)",stickers:[]},t.default=g},2606:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e){return{tumblrData:e.getStore(h.default).get("data")}}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=function(e,t,n){for(var a=!0;a;){var s=e,o=t,r=n;a=!1,null===s&&(s=Function.prototype);var i=Object.getOwnPropertyDescriptor(s,o);if(void 0!==i){if("value"in i)return i.value;var l=i.get;if(void 0===l)return;return l.call(r)}var c=Object.getPrototypeOf(s);if(null===c)return;e=c,t=o,n=r,a=!0,i=c=void 0}},u=a(n(0)),d=a(n(1)),f=a(n(1561)),p=a(n(287)),m=a(n(2588)),g=a(n(486)),h=a(n(2040)),v=a(n(2605)),y="popular",x=700,S=(0,n(28).defineMessages)({placeholder:{id:"CANVASS_SEARCH_GIF"}}),b=function(e){function t(e){s(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={isLoading:!0,search:y},this.handleSearch=(0,p.default)(this.handleSearch.bind(this),x)}return o(t,e),l(t,[{key:"componentWillMount",value:function(){this.context.executeAction(m.default,{})}},{key:"handleSearch",value:function(){var e=this.refs.search&&this.refs.search.value||y;this.setState({isLoading:!0,search:e});var t={search:e},a=this.props.tumblrData.getIn([e,"offset"]);t.offset=a||0,this.context.executeAction(m.default,t),(0,n(1268).fireRapidEvent)("secvw",{slk:"gif-search-"+e,elm:"cmmt_gif",outcm:"show",context:this.context.context,cat:this.context.tags,itc:1,t3:a||!1})}},{key:"componentWillReceiveProps",value:function(e){e.tumblrData&&this.setState({isLoading:!1})}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.search,a=this.props.tumblrData,s=a.getIn([n,"error"]),o=this.context.intl,r=a.getIn([n,"stickers"]),l=a.getIn([n,"authors"]),c=parseInt(a.getIn([n,"offset"]),10);r=r?r.toJS():[];var u=f.default.dedupe("canvass-tumblr-stickers Pos(r) Pb(15px) H(145px) tumblr D(b) W(100%)",{"H(65px)":!this.state.isLoading&&!r.length});return d.default.createElement("div",{className:u},d.default.createElement(v.default,i({},this.props,{authors:l,error:s,handleSearch:this.handleSearch,isLoading:t,offset:c,stickers:r,tumblrData:void 0})),d.default.createElement("input",{"aria-label":o.formatMessage({id:"CANVASS_SEARCH_GIFS"}),autoFocus:!0,className:"D(ib) M(0) Bd(n) H(21px) Bxsh(n) O(n) Fz(16px) canvass-tumblr-stickers-search Pos(r) B(-16px) Start(88px) Z(1)",onInput:this.handleSearch,ref:"search",placeholder:o.formatMessage(S.placeholder),type:"text"}))}}]),t}(n(1).PureComponent);t.TumblrStickers=b,b.contextTypes={context:u.default.string,executeAction:u.default.func.isRequired,intl:u.default.object,tags:u.default.string},t.default=(0,g.default)(b,[h.default],r)},2833:function(e,t,n){function a(e,t,n){var a=null==e?0:e.length;if(!a)return-1;var c=a-1;return void 0!==n&&(c=r(n),c=n<0?i(a+c,0):l(c,a-1)),s(e,o(t,3),c,!0)}var s=n(322),o=n(48),r=n(113),i=Math.max,l=Math.min;e.exports=a}});